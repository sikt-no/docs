<?php
$mal_kontaktadresse="drift@uninett.no"; // obligatorisk
$mal_overskrift="Hobbit / Xymon"; // obligatorisk
$mal_tegnsett="utf-8";
include "uninetttopp.php3";
?>
<dl>
  <dt>REVISJON:</dt>
  <dd>JUN-2015<dd>
  <dt>ANSVARLIG:</dt>
  <dd>Morten Brekkevold</dd>
  <dt>DATO:</dt>
  <dd>24.06.2015</dd>
</dl>

<hr>

<h2>Innledning</h2>
<p>
Xymon (tidl. <em>Hobbit</em>) er et tjenesteovervåkningsverktøy som kjører på
verktøykassen, og som er integrert med NAV-installasjonen der. Det er kun
utstyr som legges inn i kategorien SRV i NAV som blir automatisk overvåket av
Xymon. For mer informasjon om Xymon,
se <a href="http://sourceforge.net/projects/xymon/">Xymons hjemmesider.</a>
</p>

<h2>Tjenester</h2>
<p>
Det er Hobbit og Apache som må kjøres for at tjenesten skal virke (I Debian
Wheezy er ikke omdøping av Hobbit til Xymon komplett, så de fleste kommandoer
og konfigurasjonsfiler vil fremdeles referere til Hobbit).
</p>

<strong>hobbit</strong>
<ul>
	<li>Daemon: </li>
	<li>Start/stop: /etc/init.d/hobbit {start/stop/restart}</li>
	<li>Configfiler: /etc/hobbit/</li> 
</ul>

<strong>apache2</strong>
<ul>
	<li>Daemon: /usr/sbin/apache2</li>
	<li>Start/stopp: /etc/init.d/apache2 {start/stop/restart/reload}</li>
	<li>config: /etc/apache2/sites-available/nav</li>
</ul>

<h2>Brukerdokumentasjon</h2>

<h3>Maskiner som overvåkes med Xymon</h3>
<p>
Hver time kjører et script på verktøykassen som konfigurerer Xymon til å
overvåke alle maskiner fra SRV-kategorien i NAV. Dette gjør at det er bare ett
sted for vedlikehold listen over servere som skal overvåkes i NAV og Xymon.
Når en maskin registreres i NAV, kan den legges inn i opptil flere grupper
(<em>device groups</em>). Disse gruppene blir også brukt som grupper i Xymon.
</p>

<h3>Overvåking av grupper</h3>
<p>
Man kan sette opp overvåking av bestemte services for hver enkelt gruppe. Man
kan f.eks overvåke SMTP for alle servere som ligger i mail-gruppa. Dette
gjøres ved å logge på verktøykassen med ssh. Man redigerer
filen <code>/etc/nav/navsrv2hobbit.conf</code>. Her er et eksempel på hvordan
man kan gjøre det:
</p>

<pre><code>
[ALL]
services = ssh

[MAIL]
services = smtp
</code></pre>

<p>
Her ser vi at ssh overvåkes for samtlige maskiner, mens SMTP overvåkes bare
for den gruppen av maskiner som befinner seg i gruppen MAIL i NAV. SSH ligger
som standardovervåking for samtlige maskiner.
</p>

<h3>Overvåking av maskiner</h3>
<p>
Man kan sette opp bestemte overvåkinger for hver enkelt maskin. Dette gjøres i
ei config-fil på verktøykassen som ligger
under <code>/etc/hobbit/hobbit-clients.d/hobbit.cfg</code>. Config-fila kan se
slik ut:
</p>

<pre><code>
HOST=testserver.uninett.no
PROC        cfenvd 1 1 yellow
PROC        cfservd 1 1 red
PROC        munin-node 1 -1 red
PROC        sshd
PROC        ntpd 1 1 yellow
DISK        /home 95 98
DISK        /var/log 95 98
</code></pre>

<p>
Her ser vi hvilke bestemte prosesser som er satt opp til overvåking med at det
står PROC foran prosessnavnet. Bak hver prosess kan man ha et tall som angir
hvor mange prosesser som kan kjøres. På prosessen cfenvd står det først tallet
1 som betyr at det minimum må være en prosess (mincount) ved det navnet og bak
tallet står det 1 (maxcount). Dette betyr at det kan kun være én og bare én
prosess av cfenvd. Hvis ikke dette er oppfylt vil den blir markert som gul i
Xymon, i motsetning til cfservd, der det vil bli markert som rødt. Man kan på
denne måten angi hvor mange prosesser som skal kjøre. I tillegg kan man bruke
verdien -1, som betyr at det kan være uendelig mange prosesser som kjøres.
</p>

<p>
I tillegg kan man sette opp overvåking av disk-partisjoner.
Hvis <code>/home</code> (som i eks. over) fylles opp til 95% vil den bli gul,
mens kommer den på 98% vil den flagges rød i Xymon.
</p>

<p>
Som standard på samtlige servere står det følgende regler
(<code>/etc/hobbit/hobbit-client.cfg</code>):
</p>

<pre><code>
DEFAULT
UP      1h
LOAD    5.0 10.0
DISK    * 90 95
MEMPHYS 100 101
MEMSWAP 50 80
MEMACT  90 97
</code></pre>


<h3>Installere Hobbit-client på klienten</h3>
<ul>
  <li>
    Det må installeres hobbit-client (eller xymon-client) på klienten som skal
    overvåkes.
  </li>
  
  <li>
    IP-adressen til verktøykassen må settes
    i <code>/etc/default/hobbit-client</code>, slik at hobbit-client ver hvor
    den skal rapportere.
  </li>

  <li>
    For Windows-maskiner som skal overvåkes må det
    installeres <em><a href="http://bbwin.sourceforge.net/">BBWin</a></em> på
    klienten.
  </li>

</ul>

<h3>Varsling</h3>
<p>
Varsling fra Hobbit er integrert med NAVs hendelses- og alarmsystem, og styres
gjennom din personlige alarmprofil i NAV. Viser
til <a href="https://nav.uninett.no/" title="Gå til NAVs
hjemmesider">dokumentasjon om NAV</a>.
</p>

<h2>Kontaktadresser</h2>
<ul>
  <li><a href="mailto:drift@uninett.no">drift@uninett.no</a></li>
</ul>

<?php
include "uninettbunn.php3";
?>
