<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-iam/integrasjoner/Local_processing_nmbu" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Local Processing - NMBU | Sikt teknisk dokumentasjon</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_nmbu"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Local Processing - NMBU | Sikt teknisk dokumentasjon"><meta data-rh="true" name="description" content="G3LocalProcessing"><meta data-rh="true" property="og:description" content="G3LocalProcessing"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_nmbu"><link data-rh="true" rel="alternate" href="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_nmbu" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_nmbu" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.210d0366.css">
<script src="/assets/js/runtime~main.26b5fb14.js" defer="defer"></script>
<script src="/assets/js/main.535308e8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/sikt_logo.svg" alt="Sikt logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/sikt_logo_white.svg" alt="Sikt logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">teknisk dokumentasjon</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Local Processing - NMBU</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="g3_local_processing">G3_Local_Processing<a href="#g3_local_processing" class="hash-link" aria-label="Direct link to G3_Local_Processing" title="Direct link to G3_Local_Processing">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptotopdesk">PortalLDAPToTopDesk<a href="#portalldaptotopdesk" class="hash-link" aria-label="Direct link to PortalLDAPToTopDesk" title="Direct link to PortalLDAPToTopDesk">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description">Description<a href="#description" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script synchronizes user data from the Portal LDAP directory to TopDesk. It processes user records, performs necessary transformations, and updates or creates user accounts in TopDesk. The script also handles enabling, disabling, and archiving user accounts based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters">Input Parameters<a href="#input-parameters" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: String (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>process_total</code>: Number (optional)</li>
<li><code>log_only</code>: Boolean (optional)</li>
<li><code>report_file</code>: Boolean (optional)</li>
<li><code>debug</code>: Boolean (optional)</li>
<li><code>reprocess_all</code>: Boolean (optional)</li>
<li><code>reprocess_unprovisioned_users</code>: Boolean (optional)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables">Local Variables<a href="#local-variables" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>arrCountryCodesToStrip</code>: Array of country codes to strip from phone numbers.</li>
<li><code>targetSystem</code>: The target system, which is TopDesk.</li>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>fileDate</code>: The current date formatted as <code>yyyyMMdd</code>.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdd</code>, <code>totalAddFail</code>, <code>totalUpdate</code>, <code>totalUpdateFail</code>, <code>totalEnable</code>, <code>totalEnableFail</code>, <code>totalDisable</code>, <code>totalDisableFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>sessionMV</code>: Connection object for MV (RIDB).</li>
<li><code>cookie</code>: The cookie used for LDAP change tracking.</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>roles</code>: Array of roles for the user.</li>
<li><code>selectedUsername</code>: The username selected for the user.</li>
<li><code>selectedEmail</code>: The email address selected for the user.</li>
<li><code>isEntitled</code>, <code>isProvisioned</code>, <code>isEntitledReq</code>, <code>isProvisionedReq</code>: Booleans indicating the user&#x27;s entitlements and provisioning status.</li>
<li><code>branch</code>, <code>department</code>, <code>budgetHolder</code>, <code>recordManager</code>, <code>recordPrivateDetails</code>, <code>optionalFields1</code>, <code>personExtraFieldA</code>: Various records and objects used for transformations and provisioning.</li>
<li><code>currentID</code>, <code>currentOperatorID</code>: Current IDs for the user in TopDesk.</li>
<li><code>recordTopDesk</code>, <code>recordTopDeskOperator</code>: Records fetched from TopDesk.</li>
<li><code>isArchived</code>, <code>isOperatorArchived</code>: Booleans indicating if the user or operator is archived in TopDesk.</li>
<li><code>isDeprovisionSuccessful</code>: Boolean indicating if the deprovisioning process was successful.</li>
<li><code>recordEntitlementsSucessfullyDeprovisioned</code>: Record of entitlements successfully deprovisioned.</li>
<li><code>arrayEntitlementsSucessfullyProvisioned</code>: Array of entitlements successfully provisioned.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">Workflow<a href="#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP and MV.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Fetch Data from TopDesk</strong></li>
</ol>
<ul>
<li>Fetch branches, departments, budget holders, and archiving reasons from TopDesk.</li>
<li>Handle errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="4">
<li><strong>Set Cookie</strong></li>
</ol>
<ul>
<li>Determine the appropriate cookie based on <code>log_only</code> parameter.</li>
</ul>
<ol start="5">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="6">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="7">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>firstName</code>, <code>surName</code>, <code>jobTitle</code>, <code>networkLoginName</code>, <code>email</code>, <code>mobileNumber</code>, etc.</li>
<li>Create and set objects for branch, department, budget holder, manager, and private details.</li>
<li>Filter record fields to only include attributes being provisioned.</li>
</ul>
<ol start="8">
<li><strong>Sync Person Data to TopDesk</strong></li>
</ol>
<ul>
<li>Query TopDesk for the user based on the current ID or username.</li>
<li>Handle errors and log results.</li>
<li>Save the person record to TopDesk and update Portal LDAP with provisioning status.</li>
<li>Handle archiving and unarchiving of users based on entitlements.</li>
</ul>
<ol start="9">
<li><strong>Sync Operator Data to TopDesk</strong></li>
</ol>
<ul>
<li>Create and transform the operator record.</li>
<li>Query TopDesk for the operator based on the current ID or email.</li>
<li>Handle errors and log results.</li>
<li>Save the operator record to TopDesk and update Portal LDAP with provisioning status.</li>
<li>Handle archiving and unarchiving of operators based on entitlements.</li>
</ul>
<ol start="10">
<li><strong>Deprovision Requestables</strong></li>
</ol>
<ul>
<li>Deprovision requestable entitlements if necessary.</li>
<li>Handle errors and log results.</li>
</ul>
<ol start="11">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP and MV.</li>
</ul>
<ol start="12">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the synchronization process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications">External Systems and Communications<a href="#external-systems-and-communications" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
<li><strong>MV (RIDB)</strong>: Used to query organizational levels.</li>
<li><strong>TopDesk</strong>: The target system where user accounts are created, updated, enabled, disabled, and archived.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs">Response Codes/Outputs<a href="#response-codesoutputs" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>None explicitly mentioned.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script synchronizes user data from the Portal LDAP directory to TopDesk. It handles various operations such as creating, updating, enabling, disabling, and archiving user accounts based on specific conditions. The script ensures data consistency and logs detailed results of the synchronization process.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="g3_local_processing-1">G3_Local_Processing<a href="#g3_local_processing-1" class="hash-link" aria-label="Direct link to G3_Local_Processing" title="Direct link to G3_Local_Processing">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptotopdesk-1">PortalLDAPToTopDesk<a href="#portalldaptotopdesk-1" class="hash-link" aria-label="Direct link to PortalLDAPToTopDesk" title="Direct link to PortalLDAPToTopDesk">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-1">Description<a href="#description-1" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script synchronizes user data from the Portal LDAP directory to TopDesk. It processes user records, performs necessary transformations, and updates or creates user accounts in TopDesk. The script also handles enabling, disabling, and archiving user accounts based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-1">Input Parameters<a href="#input-parameters-1" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: String (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>process_total</code>: Number (optional)</li>
<li><code>log_only</code>: Boolean (optional)</li>
<li><code>report_file</code>: Boolean (optional)</li>
<li><code>debug</code>: Boolean (optional)</li>
<li><code>reprocess_all</code>: Boolean (optional)</li>
<li><code>reprocess_unprovisioned_users</code>: Boolean (optional)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-1">Local Variables<a href="#local-variables-1" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>arrCountryCodesToStrip</code>: Array of country codes to strip from phone numbers.</li>
<li><code>targetSystem</code>: The target system, which is TopDesk.</li>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>fileDate</code>: The current date formatted as <code>yyyyMMdd</code>.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdd</code>, <code>totalAddFail</code>, <code>totalUpdate</code>, <code>totalUpdateFail</code>, <code>totalEnable</code>, <code>totalEnableFail</code>, <code>totalDisable</code>, <code>totalDisableFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>sessionMV</code>: Connection object for MV (RIDB).</li>
<li><code>cookie</code>: The cookie used for LDAP change tracking.</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>roles</code>: Array of roles for the user.</li>
<li><code>selectedUsername</code>: The username selected for the user.</li>
<li><code>selectedEmail</code>: The email address selected for the user.</li>
<li><code>isEntitled</code>, <code>isProvisioned</code>, <code>isEntitledReq</code>, <code>isProvisionedReq</code>: Booleans indicating the user&#x27;s entitlements and provisioning status.</li>
<li><code>branch</code>, <code>department</code>, <code>budgetHolder</code>, <code>recordManager</code>, <code>recordPrivateDetails</code>: Various records for user attributes.</li>
<li><code>isArchived</code>, <code>isOperatorArchived</code>: Booleans indicating if the user or operator is archived.</li>
<li><code>currentID</code>, <code>currentOperatorID</code>: Current IDs for the user and operator in TopDesk.</li>
<li><code>recordTopDesk</code>, <code>recordTopDeskOperator</code>: Records fetched from TopDesk for the user and operator.</li>
<li><code>isDeprovisionSuccessful</code>: Boolean indicating if deprovisioning was successful.</li>
<li><code>recordEntitlementsSucessfullyDeprovisioned</code>: Record of successfully deprovisioned entitlements.</li>
<li><code>arrayEntitlementsSucessfullyProvisioned</code>: Array of successfully provisioned entitlements.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-1">Workflow<a href="#workflow-1" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP and MV.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Set Cookie</strong></li>
</ol>
<ul>
<li>Determine the appropriate cookie based on <code>log_only</code> parameter.</li>
</ul>
<ol start="4">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="5">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="6">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>firstName</code>, <code>surName</code>, <code>jobTitle</code>, <code>networkLoginName</code>, <code>email</code>, <code>mobileNumber</code>, etc.</li>
<li>Create and set additional records for <code>branch</code>, <code>department</code>, <code>budgetHolder</code>, <code>manager</code>, and <code>privateDetails</code>.</li>
</ul>
<ol start="7">
<li><strong>Match and Update TopDesk</strong></li>
</ol>
<ul>
<li><strong>Check Existence in TopDesk</strong>:<!-- -->
<ul>
<li>Check if the user exists in TopDesk.</li>
<li>Handle errors and duplicate accounts.</li>
</ul>
</li>
<li><strong>Create New Account</strong>:<!-- -->
<ul>
<li>If the user does not exist in TopDesk and is entitled, create a new account.</li>
<li>Perform necessary data formation and set attributes.</li>
<li>Log the creation process and update Portal LDAP with provisioning status.</li>
</ul>
</li>
<li><strong>Update Existing Account</strong>:<!-- -->
<ul>
<li>If the user exists in TopDesk, compare changes and update the account if necessary.</li>
<li>Handle enabling, disabling, and archiving of the account based on the user&#x27;s entitlements and changes.</li>
<li>Log the update process and update Portal LDAP with provisioning status if needed.</li>
</ul>
</li>
</ul>
<ol start="8">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP and MV.</li>
</ul>
<ol start="9">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the synchronization process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-1">External Systems and Communications<a href="#external-systems-and-communications-1" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
<li><strong>MV (RIDB)</strong>: Used to query organizational levels.</li>
<li><strong>TopDesk</strong>: The target system where user accounts are created, updated, enabled, disabled, and archived.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-1">Response Codes/Outputs<a href="#response-codesoutputs-1" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>None explicitly mentioned.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-1">Summary<a href="#summary-1" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script synchronizes user data from the Portal LDAP directory to TopDesk. It handles various operations such as creating, updating, enabling, disabling, and archiving user accounts based on specific conditions. The script ensures data consistency and logs detailed results of the synchronization process.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptowiseflow">PortalLdapToWISEflow<a href="#portalldaptowiseflow" class="hash-link" aria-label="Direct link to PortalLdapToWISEflow" title="Direct link to PortalLdapToWISEflow">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-2">Description<a href="#description-2" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script provisions users and roles to WISEflow. It processes user records from a portal directory, performs necessary transformations, and updates or creates user accounts in WISEflow. The script also handles enabling, disabling, and updating user roles based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-2">Input Parameters<a href="#input-parameters-2" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: String (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>log_only</code>: Boolean (optional)</li>
<li><code>debug</code>: Boolean (optional)</li>
<li><code>process_all</code>: Boolean (optional)</li>
<li><code>load</code>: Boolean</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-2">Local Variables<a href="#local-variables-2" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>fnr</code>, <code>feideID</code>, <code>pln</code>: Local user data types.</li>
<li><code>rolesToProvision</code>: Array of roles that RI is allowed to provision/deprovision.</li>
<li><code>langMap</code>: Mapping of languages to their respective codes.</li>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdd</code>, <code>totalAddFail</code>, <code>totalUpdate</code>, <code>totalUpdateFail</code>, <code>totalEnable</code>, <code>totalEnableFail</code>, <code>totalDisable</code>, <code>totalDisableFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>policyFile</code>: The policy file for WISEflow ruleset.</li>
<li><code>processedAccounts</code>: Array to keep track of processed accounts.</li>
<li><code>targetSystem</code>: The target system, which is WISEflow.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>arrAllRoles</code>: Array of all roles retrieved from WISEflow.</li>
<li><code>cookie</code>: The cookie used for LDAP change tracking.</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>isAssigned</code>, <code>isProvisioned</code>, <code>isAssignedReq</code>, <code>isProvisionedReq</code>: Booleans indicating the user&#x27;s assignment and provisioning status.</li>
<li><code>isDisabled</code>: Boolean indicating if the user is disabled.</li>
<li><code>arrEmails</code>, <code>arrEmailsToAdd</code>, <code>arrEmailsToRemove</code>, <code>arrayEmailsRemoved</code>, <code>arrayEmailsFailedToRemove</code>: Arrays for managing user emails.</li>
<li><code>arrExternalIDs</code>, <code>arrExtIDsToAdd</code>, <code>arrExtIDsToRemove</code>, <code>arrExtIDSRemoved</code>, <code>arrExtIDSFailedToRemove</code>: Arrays for managing user external IDs.</li>
<li><code>record</code>: The record formatted for provisioning to WISEflow.</li>
<li><code>arrBusRoles</code>: Array of business roles for the user.</li>
<li><code>isExternalSensor</code>: Boolean indicating if the user is an external sensor.</li>
<li><code>hasFnrChanged</code>, <code>hasFnr</code>: Booleans indicating if the user&#x27;s national ID has changed or exists.</li>
<li><code>selectedUsername</code>: The username selected for the user.</li>
<li><code>primaryEmail</code>, <code>secondaryEmail</code>: The primary and secondary email addresses for the user.</li>
<li><code>arrEmailObjects</code>: Array of email objects for the user.</li>
<li><code>preferred_language</code>: The preferred language of the user.</li>
<li><code>recordePPNIdentifier</code>, <code>recordBirthnumberIdentifier</code>, <code>recordFSIdentifier</code>: Records for external IDs.</li>
<li><code>authorizedAccesses</code>, <code>arrayAuthorizedAccesses</code>: Authorized accesses for the user.</li>
<li><code>arrRoles</code>: Array of roles for the user.</li>
<li><code>exists</code>, <code>baseObject</code>: Objects indicating if the user exists in WISEflow.</li>
<li><code>isLoginDeactivated</code>, <code>existingPreferredLanguage</code>: Booleans indicating if the user&#x27;s login is deactivated and their existing preferred language.</li>
<li><code>recordUpdate</code>, <code>recordRemove</code>: Records for updating and removing user data in Portal LDAP.</li>
<li><code>oldRoles</code>, <code>arrOldRoles</code>, <code>arrNewRoles</code>: Arrays for managing old and new roles.</li>
<li><code>arrOldEmails</code>, <code>existingPrimaryEmail</code>, <code>existingOtherEmails</code>, <code>existingOtherEmailsArr</code>: Arrays and objects for managing old emails.</li>
<li><code>arrOldExtIds</code>, <code>arrNewExtIds</code>, <code>arrPatchExtID</code>: Arrays for managing old and new external IDs.</li>
<li><code>hasBaseRecordChanged</code>, <code>hasRolesChanged</code>, <code>hasExternalIdsChanged</code>, <code>hasEmailChanged</code>, <code>hasRecordChanged</code>: Booleans indicating if various parts of the record have changed.</li>
<li><code>arrRolesToAdd</code>, <code>arrRolesToRemove</code>: Arrays for managing roles to add and remove.</li>
<li><code>arrExtIDsToAdd</code>, <code>arrExtIDsToRemove</code>, <code>arrPatchExtID</code>: Arrays for managing external IDs to add, remove, and patch.</li>
<li><code>isUpdateSuccessful</code>: Boolean indicating if the update was successful.</li>
<li><code>recordUpdateWf</code>, <code>recordDisableWf</code>: Records for updating and disabling user data in WISEflow.</li>
<li><code>putResults</code>, <code>disableResults</code>: Results of the PUT operations in WISEflow.</li>
<li><code>extCreate</code>, <code>extPutRecord</code>, <code>extDisableRecord</code>: Extended properties for the user.</li>
<li><code>resultAddRoles</code>, <code>resultRemoveRole</code>, <code>resultPostEmails</code>, <code>resultPatchPrimaryEmail</code>, <code>resultPatchExtId</code>, <code>resultDeleteExtIDs</code>, <code>resultPostExtIDs</code>: Results of various operations in WISEflow.</li>
<li><code>arrRemovedRoles</code>, <code>arrRolesFailedToRemove</code>: Arrays for managing removed and failed-to-remove roles.</li>
<li><code>arrExtIDSRemoved</code>, <code>arrExtIDSFailedToRemove</code>: Arrays for managing removed and failed-to-remove external IDs.</li>
<li><code>extAddRoles</code>, <code>extRoles</code>, <code>extPatchExtID</code>, <code>extRemoveExtID</code>, <code>extFailedRemoveExtID</code>, <code>extLDAPUpdate</code>: Extended properties for various operations.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-2">Workflow<a href="#workflow-2" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Retrieve Roles from WISEflow</strong></li>
</ol>
<ul>
<li>Fetch all roles from WISEflow.</li>
<li>Handle errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="4">
<li><strong>Set Cookie</strong></li>
</ol>
<ul>
<li>Determine the appropriate cookie based on <code>log_only</code> parameter.</li>
</ul>
<ol start="5">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="6">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="7">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>firstName</code>, <code>lastName</code>, <code>emails</code>, <code>phone</code>, <code>preferred_language</code>, <code>externalIds</code>, etc.</li>
</ul>
<ol start="8">
<li><strong>Access Logic</strong></li>
</ol>
<ul>
<li>Determine authorized accesses for the user based on the policy file.</li>
<li>Set roles for the user.</li>
</ul>
<ol start="9">
<li><strong>Query System for User</strong></li>
</ol>
<ul>
<li>Check if the user exists in WISEflow using various identifiers.</li>
<li>Handle errors and duplicate accounts.</li>
</ul>
<ol start="10">
<li><strong>Create or Update User</strong></li>
</ol>
<ul>
<li><strong>Create New User</strong>:<!-- -->
<ul>
<li>If the user does not exist in WISEflow and is assigned or requested, create a new user.</li>
<li>Log the creation process and update Portal LDAP with provisioning status.</li>
</ul>
</li>
<li><strong>Update or Disable User</strong>:<!-- -->
<ul>
<li>If the user exists in WISEflow, compare changes and update the account if necessary.</li>
<li>Handle enabling, disabling, and updating roles, emails, and external IDs.</li>
<li>Log the update process and update Portal LDAP with provisioning status if needed.</li>
</ul>
</li>
</ul>
<ol start="11">
<li><strong>Update Portal LDAP</strong></li>
</ol>
<ul>
<li>Update or remove user data in Portal LDAP based on the changes made in WISEflow.</li>
</ul>
<ol start="12">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP.</li>
</ul>
<ol start="13">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the provisioning process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-2">External Systems and Communications<a href="#external-systems-and-communications-2" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>WISEflow</strong>: The script interacts with the WISEflow API to perform user provisioning, updating, and disabling. The primary endpoints used are for retrieving roles, creating users, updating users, and managing user roles, emails, and external IDs.</li>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-2">Response Codes/Outputs<a href="#response-codesoutputs-2" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>None explicitly mentioned.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-2">Summary<a href="#summary-2" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script provisions users and roles to WISEflow by processing user records from a portal directory, performing necessary transformations, and updating or creating user accounts in WISEflow. It handles various operations such as creating, updating, enabling, disabling, and managing user roles, emails, and external IDs. The script ensures data consistency and logs detailed results of the provisioning process.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptoberghansencsv">PortalLdapToBergHansenCSV<a href="#portalldaptoberghansencsv" class="hash-link" aria-label="Direct link to PortalLdapToBergHansenCSV" title="Direct link to PortalLdapToBergHansenCSV">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-3">Description<a href="#description-3" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script generates a CSV file containing employee data formatted for Berg-Hansen. It retrieves data from a Portal LDAP, processes it, and optionally uploads the file to a remote SFTP server.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-3">Input Parameters<a href="#input-parameters-3" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>log_only</code>: Boolean indicating whether to only log the output without uploading it to the remote server.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-3">Local Variables<a href="#local-variables-3" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>genderTitleMap</code>: A mapping of gender codes to titles (Mr/Ms).</li>
<li><code>gender</code>: A variable to store the gender of the employee.</li>
<li><code>date</code>: The current date formatted as <code>yyyyMMdd</code>.</li>
<li><code>hours</code>: The current time formatted as <code>HHmmss</code>.</li>
<li><code>outputFileName</code>: The name of the output CSV file.</li>
<li><code>localFilePath</code>: The local directory path where the output file will be saved.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>fileOut</code>: The file output object for writing the CSV file.</li>
<li><code>remoteFileSys</code>: The remote filesystem object for SFTP connection.</li>
<li><code>ldapRecords</code>: The set of records fetched from Portal LDAP.</li>
<li><code>outputData</code>: An array to store the formatted output data.</li>
<li><code>recordBergHansen</code>: A record object to store the formatted data for each employee.</li>
<li><code>formattedBirthdate</code>: The formatted birthdate of the employee.</li>
<li><code>selectedUsername</code>: The selected username for the employee.</li>
<li><code>selectedEmail</code>: The selected email address for the employee.</li>
<li><code>splitDeptCode</code>: An array containing the split department code.</li>
<li><code>numRecords</code>: The number of records in the output data array.</li>
<li><code>formattedTime</code>: The current date and time formatted as <code>yyyy-MM-dd HH:mm:ss:ms</code>.</li>
<li><code>outputStr</code>: The final output string to be written to the CSV file.</li>
<li><code>result</code>: The result of the file save operation.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-3">Workflow<a href="#workflow-3" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for variables and format the current date and time.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish a connection to Portal LDAP.</li>
<li>Handle connection errors by logging and returning.</li>
</ul>
<ol start="3">
<li><strong>Open Output File</strong></li>
</ol>
<ul>
<li>Open the local output file for writing in ISO-8859-1 character set.</li>
<li>If <code>log_only</code> is false, establish a remote SFTP connection.</li>
</ul>
<ol start="4">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch employee records from Portal LDAP based on specific filters and attributes.</li>
</ul>
<ol start="5">
<li><strong>Process Records</strong></li>
</ol>
<ul>
<li>Iterate over each LDAP record and format the data for Berg-Hansen.</li>
<li>Populate the <code>recordBergHansen</code> object with formatted values.</li>
<li>Append the formatted record to the <code>outputData</code> array.</li>
</ul>
<ol start="6">
<li><strong>Write Data</strong></li>
</ol>
<ul>
<li>Insert the header row into the <code>outputData</code> array.</li>
<li>Join the array into a single string and write it to the local output file.</li>
<li>If <code>log_only</code> is false, upload the file to the remote SFTP server.</li>
</ul>
<ol start="7">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close the local output file and the Portal LDAP connection.</li>
<li>If a remote SFTP connection was established, close it as well.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-3">External Systems and Communications<a href="#external-systems-and-communications-3" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Portal LDAP</strong>: Used to fetch employee records and attributes.</li>
<li><strong>Remote SFTP Server</strong>: Optionally used to upload the generated CSV file.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-3">Response Codes/Outputs<a href="#response-codesoutputs-3" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>The script logs the output data and the result of the file save operation.</li>
<li>If <code>log_only</code> is false, the script uploads the file to the remote SFTP server and logs the result.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-3">Summary<a href="#summary-3" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script generates a CSV file containing employee data formatted for Berg-Hansen. It retrieves data from Portal LDAP, processes it, and optionally uploads the file to a remote SFTP server. The script handles various data formatting requirements and ensures that the output is correctly structured for Berg-Hansen&#x27;s needs.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptocristin">PortalLdapToCristin<a href="#portalldaptocristin" class="hash-link" aria-label="Direct link to PortalLdapToCristin" title="Direct link to PortalLdapToCristin">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-4">Description<a href="#description-4" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script generates an XML file for uploading to Cristin via SFTP. It collects organization and person data, formats it into the required XML structure, validates the XML, and uploads it to the Cristin server. The script also updates the provisioning status for users after the file is successfully uploaded.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-4">Input Parameters<a href="#input-parameters-4" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>verbose</code>: Boolean (optional) to enable verbose logging.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-4">Local Variables<a href="#local-variables-4" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>sessionMV</code>: Connection object for MetaVault (RIDB).</li>
<li><code>sessionPortalLDAP</code>: Connection object for MetaDirectory LDAP.</li>
<li><code>configuration_file</code>: The configuration file loaded as a string.</li>
<li><code>configuration</code>: Parsed JSON configuration.</li>
<li><code>today_date</code>, <code>today_date_filename</code>: Current date in different formats.</li>
<li><code>filename</code>, <code>filepath</code>: Name and path of the output XML file.</li>
<li><code>keyword</code>: Keyword for provisioning status.</li>
<li><code>orgdata_file</code>: Organization data file loaded as a string.</li>
<li><code>orgdata</code>: Parsed JSON organization data.</li>
<li><code>organizations</code>: Array of organization data.</li>
<li><code>org_lookup</code>: Lookup table for organization keys.</li>
<li><code>master_persons</code>: Array of master person data.</li>
<li><code>master_person_lookup</code>: Lookup table for master person data.</li>
<li><code>userRecords</code>: Array of user records fetched from LDAP.</li>
<li><code>people</code>, <code>new_users</code>, <code>removed_users</code>: Arrays to store processed user data.</li>
<li><code>encoding</code>: Character encoding for the XML file.</li>
<li><code>file</code>: File output object for the XML file.</li>
<li><code>fileAsString</code>: XML file content as a string.</li>
<li><code>xml_object</code>: Parsed XML object.</li>
<li><code>is_valid_xml</code>: Boolean indicating if the XML is valid.</li>
<li><code>sftpPrivKey</code>: SFTP private key loaded as a string.</li>
<li><code>remoteFileSys</code>: Remote filesystem object for SFTP.</li>
<li><code>cristin_file</code>: XML file content for uploading.</li>
<li><code>result</code>: Result of the file upload operation.</li>
<li><code>list</code>: List of files on the remote server.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-4">Workflow<a href="#workflow-4" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Establish connections to MetaVault and MetaDirectory.</li>
<li>Load and parse the configuration file.</li>
<li>Set the current date and filename for the XML file.</li>
</ul>
<ol start="2">
<li><strong>Collect Organization Data</strong></li>
</ol>
<ul>
<li>Load and parse the organization data file.</li>
<li>Populate the <code>organizations</code> array and <code>org_lookup</code> table.</li>
</ul>
<ol start="3">
<li><strong>Person Position Lookup</strong></li>
</ol>
<ul>
<li>Query the master person data from MetaVault.</li>
<li>Populate the <code>master_person_lookup</code> table.</li>
</ul>
<ol start="4">
<li><strong>Collect Person Data</strong></li>
</ol>
<ul>
<li>Fetch user records from MetaDirectory based on specific filters.</li>
<li>Process each user record to extract relevant information and populate the <code>people</code>, <code>new_users</code>, and <code>removed_users</code> arrays.</li>
</ul>
<ol start="5">
<li><strong>Write XML File</strong></li>
</ol>
<ul>
<li>Open the XML file for writing with the specified encoding.</li>
<li>Write the XML header, description, institution, organization, and person data to the file.</li>
<li>Close the XML file.</li>
</ul>
<ol start="6">
<li><strong>Validate XML Format</strong></li>
</ol>
<ul>
<li>Load the XML file as a string and parse it to check if it is valid XML.</li>
<li>Log the validation result.</li>
</ul>
<ol start="7">
<li><strong>Transfer File to Cristin</strong></li>
</ol>
<ul>
<li>Establish an SFTP connection to the Cristin server.</li>
<li>Upload the XML file to the server.</li>
<li>Log the upload result and list the files on the remote server.</li>
<li>Close the SFTP connection.</li>
</ul>
<ol start="8">
<li><strong>Update Provisioning Status</strong></li>
</ol>
<ul>
<li>Update the provisioning status for new and removed users in MetaDirectory.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-4">External Systems and Communications<a href="#external-systems-and-communications-4" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>MetaVault (RIDB)</strong>: Used to query master person data.</li>
<li><strong>MetaDirectory LDAP</strong>: Used to fetch user records and update provisioning status.</li>
<li><strong>Cristin Server</strong>: The target system for uploading the XML file via SFTP.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-4">Response Codes/Outputs<a href="#response-codesoutputs-4" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>The script logs various messages indicating the progress and results of each step.</li>
<li>The XML file is uploaded to the Cristin server, and the provisioning status for users is updated.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-4">Summary<a href="#summary-4" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script automates the process of generating and uploading an XML file to Cristin. It ensures that the data is correctly formatted and validated before uploading. The script also handles updating the provisioning status for users, making it a comprehensive solution for Cristin data synchronization.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integratoportalldap_orgaccesszones">IntegraToPortalLDAP_OrgAccessZones<a href="#integratoportalldap_orgaccesszones" class="hash-link" aria-label="Direct link to IntegraToPortalLDAP_OrgAccessZones" title="Direct link to IntegraToPortalLDAP_OrgAccessZones">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-5">Description<a href="#description-5" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script fetches access zones from Integra based on organizational units and updates the ruleset in the <code>integra_org_accesszones on</code> file. The script iterates through organizational units, fetches corresponding access zones from Integra, and updates the ruleset accordingly.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-5">Input Parameters<a href="#input-parameters-5" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>log_only</code>: Boolean indicating whether to run the script in log-only mode.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-5">Local Variables<a href="#local-variables-5" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>actionsetName</code>: The name of the current action set.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdded</code>, <code>totalAddedFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>arrRules</code>: Array to store the rules to be added to the ruleset.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>sessionMV</code>: Connection object for MV (RIDB).</li>
<li><code>orgunits</code>: The set of organizational units fetched from the database.</li>
<li><code>stedkode</code>: The location code derived from the organizational unit.</li>
<li><code>arrTypes</code>: Array of types to be processed (e.g., <code>ANSATT</code>, <code>ASSOSIERT</code>).</li>
<li><code>integraId</code>: The ID of the access zone fetched from Integra.</li>
<li><code>recordOrg</code>: The record object for the organizational unit.</li>
<li><code>perpetrator</code>: The perpetrator object for the organizational unit.</li>
<li><code>rules</code>: The ruleset object to be saved to the file.</li>
<li><code>success</code>: Boolean indicating whether the file update was successful.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-5">Workflow<a href="#workflow-5" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP and MV.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Query Organizational Units</strong></li>
</ol>
<ul>
<li>Fetch organizational units from the <code>orgreg_load</code> table in MV.</li>
<li>Log the number of organizational units fetched.</li>
</ul>
<ol start="4">
<li><strong>Iterate Through Organizational Units</strong></li>
</ol>
<ul>
<li>For each organizational unit, derive the <code>stedkode</code> and iterate through the types (<code>ANSATT</code>, <code>ASSOSIERT</code>).</li>
<li>Fetch the access zone ID from Integra using the <code>FnIntegraOperations</code> function.</li>
<li>If the access zone is not found, log the message and continue to the next type.</li>
<li>Create a record for the organizational unit and set its fields.</li>
<li>Append the record to the <code>arrRules</code> array.</li>
<li>Increment the <code>totalAdded</code> counter.</li>
</ul>
<ol start="5">
<li><strong>Update Ruleset File</strong></li>
</ol>
<ul>
<li>Create a ruleset object and set its <code>rules</code> field to the <code>arrRules</code> array.</li>
<li>If running in log-only mode, log the ruleset object.</li>
<li>Otherwise, save the ruleset object to the <code>integra_org_accesszones on</code> file.</li>
<li>Log the success or failure of the file update.</li>
</ul>
<ol start="6">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP and MV.</li>
</ul>
<ol start="7">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the script execution, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-5">External Systems and Communications<a href="#external-systems-and-communications-5" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Integra</strong>: Used to fetch access zone IDs based on organizational unit names.</li>
<li><strong>Portal LDAP</strong>: Used to establish a connection for potential future operations.</li>
<li><strong>MV (RIDB)</strong>: Used to query organizational units from the <code>orgreg_load</code> table.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-5">Response Codes/Outputs<a href="#response-codesoutputs-5" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>The script logs the results of the execution, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-5">Summary<a href="#summary-5" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script fetches access zones from Integra based on organizational units and updates the ruleset in the <code>integra_org_accesszones on</code> file. It handles various operations such as fetching organizational units, querying access zones, creating records, and updating the ruleset file. The script ensures data consistency and logs detailed results of the execution process.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptointegra">PortalLDAPToIntegra<a href="#portalldaptointegra" class="hash-link" aria-label="Direct link to PortalLDAPToIntegra" title="Direct link to PortalLDAPToIntegra">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-6">Description<a href="#description-6" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script handles the provisioning of new and updated users to Integra. It processes user records, performs necessary transformations, and updates or creates user accounts in Integra. The script also handles enabling, disabling, and moving user accounts based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-6">Input Parameters<a href="#input-parameters-6" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: Enum: <code>idautoPersonSystem1ID</code>, <code>idautoPersonSAMAccountName</code>, <code>idautoID</code> (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>log_only</code>: Boolean</li>
<li><code>debug</code>: Boolean (optional)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-6">Local Variables<a href="#local-variables-6" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>actionsetName</code>: The name of the current action set.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdded</code>, <code>totalAddedFail</code>, <code>totalUpdated</code>, <code>totalUpdatedFail</code>, <code>totalDisabled</code>, <code>totalDisabledFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>norwegianTime</code>, <code>formatter</code>, <code>timeNow</code>: Variables for handling the current time in Norwegian time zone.</li>
<li><code>processedAccounts</code>: Array to keep track of processed accounts.</li>
<li><code>cookie</code>: The cookie used for LDAP change tracking.</li>
<li><code>fileAccessZones</code>, <code>fileOrgAccessZones</code>: JSON files containing access zone rules.</li>
<li><code>arrAccessZonesMaintainedByRI</code>: Array of access zones maintained by RI.</li>
<li><code>sessionPortalLDAP</code>, <code>sessionMV</code>: Connection objects for Portal LDAP and MV (RIDB).</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>arrEntitlements</code>, <code>arrAppRoles4</code>, <code>arrEntitlementsProvisioned</code>, <code>arrRequestedEntitlements</code>, <code>arrRequestedEntitlementsProvisioned</code>, <code>arrBusinessRoles</code>: Arrays of entitlements and roles for the user.</li>
<li><code>isEntitledToIntegra</code>: Boolean indicating if the user is entitled to Integra.</li>
<li><code>selectedUsername</code>, <code>selectedEmail</code>: The username and email address selected for the user.</li>
<li><code>record</code>: The record formatted for provisioning to Integra.</li>
<li><code>givenName</code>, <code>sn</code>: The given name and surname of the user.</li>
<li><code>startDate</code>: The start date for the user.</li>
<li><code>employeeType</code>: The type of employee (e.g., <code>ansatt</code>, <code>assosiert</code>, <code>student</code>).</li>
<li><code>arrCalculatedAccessZones</code>, <code>arrStedkode</code>: Arrays for calculated access zones and location codes.</li>
<li><code>arrParentFolderPath</code>: Array for the parent folder path.</li>
<li><code>exists</code>: Boolean indicating if the user exists in Integra.</li>
<li><code>recordIntegra</code>: The Integra record of the user.</li>
<li><code>accessCards</code>: Array of access cards for the user.</li>
<li><code>hasUserChanges</code>, <code>hasAccessZoneChanges</code>: Booleans indicating if there are changes to the user or access zones.</li>
<li><code>arrExistingAccessZones</code>, <code>arrAccessZonesToAdd</code>, <code>arrAccessZonesToRemove</code>: Arrays for existing, added, and removed access zones.</li>
<li><code>changes</code>, <code>changedFieldNames</code>: The changes detected in the record and their field names.</li>
<li><code>recordAdd</code>, <code>recordRemove</code>: Records for adding and removing attributes in Portal LDAP.</li>
<li><code>extProperties</code>: Extended properties for the user.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-6">Workflow<a href="#workflow-6" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP and MV.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Fetch Access Zones</strong></li>
</ol>
<ul>
<li>Load and parse JSON files for access zones.</li>
<li>Populate <code>arrAccessZonesMaintainedByRI</code> with access zones maintained by RI.</li>
</ul>
<ol start="4">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="5">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Skip accounts already processed.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="6">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>FirstName</code>, <code>Surname</code>, <code>ControlNumber</code>, <code>ExtendedInfo1</code>, <code>ExtendedInfo2</code>, <code>ExtendedInfo3</code>, <code>ExtendedInfo4</code>, <code>ExtendedInfo5</code>, <code>ExtendedInfo7</code>, <code>FreeInfo1</code>, <code>accessZones</code>, <code>ParentFolderPath</code>, etc.</li>
<li>Remove attributes that should not be provisioned to Integra.</li>
</ul>
<ol start="7">
<li><strong>Match and Update Integra</strong></li>
</ol>
<ul>
<li><strong>Check Existence in Integra</strong>:<!-- -->
<ul>
<li>Check if the user exists in Integra.</li>
<li>Handle errors and duplicate accounts.</li>
</ul>
</li>
<li><strong>Create New Account</strong>:<!-- -->
<ul>
<li>If the user does not exist in Integra and is entitled to Integra, create a new account.</li>
<li>Perform necessary data formation and set attributes.</li>
<li>Log the creation process and update Portal LDAP with provisioning status.</li>
</ul>
</li>
<li><strong>Update Existing Account</strong>:<!-- -->
<ul>
<li>If the user exists in Integra, compare changes and update the account if necessary.</li>
<li>Handle enabling, disabling, moving, and renaming of the account based on the user&#x27;s entitlements and changes.</li>
<li>Log the update process and update Portal LDAP with provisioning status if needed.</li>
</ul>
</li>
</ul>
<ol start="8">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP and MV.</li>
</ul>
<ol start="9">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the synchronization process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-6">External Systems and Communications<a href="#external-systems-and-communications-6" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
<li><strong>MV (RIDB)</strong>: Used to query user roles and affiliations.</li>
<li><strong>Integra</strong>: The target system where user accounts are created, updated, enabled, disabled, and moved.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-6">Response Codes/Outputs<a href="#response-codesoutputs-6" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>None explicitly mentioned.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-6">Summary<a href="#summary-6" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script handles the provisioning of new and updated users to Integra. It processes user records, performs necessary transformations, and updates or creates user accounts in Integra. The script ensures data consistency and logs detailed results of the synchronization process.</p>
<hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/sikt-no/docs/tree/master/docs/iam/integrasjoner/Local_processing_nmbu.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-03-18T08:20:59.000Z" itemprop="dateModified">Mar 18, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#g3_local_processing" class="table-of-contents__link toc-highlight">G3_Local_Processing</a><ul><li><a href="#portalldaptotopdesk" class="table-of-contents__link toc-highlight">PortalLDAPToTopDesk</a></li></ul></li><li><a href="#g3_local_processing-1" class="table-of-contents__link toc-highlight">G3_Local_Processing</a><ul><li><a href="#portalldaptotopdesk-1" class="table-of-contents__link toc-highlight">PortalLDAPToTopDesk</a></li><li><a href="#portalldaptowiseflow" class="table-of-contents__link toc-highlight">PortalLdapToWISEflow</a></li><li><a href="#portalldaptoberghansencsv" class="table-of-contents__link toc-highlight">PortalLdapToBergHansenCSV</a></li><li><a href="#portalldaptocristin" class="table-of-contents__link toc-highlight">PortalLdapToCristin</a></li><li><a href="#integratoportalldap_orgaccesszones" class="table-of-contents__link toc-highlight">IntegraToPortalLDAP_OrgAccessZones</a></li><li><a href="#portalldaptointegra" class="table-of-contents__link toc-highlight">PortalLDAPToIntegra</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Sikt Docs</div><ul class="footer__items clean-list"><li class="footer__item"><p>Teknisk dokumentasjon på fellesløsningene Sikt leverer for utdanning og forskning.</p></li></ul></div><div class="col footer__col"><div class="footer__title">Hvordan bidra?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sikt-no/docs#editing-the-site-directly-from-the-web-browser" target="_blank" rel="noopener noreferrer" class="footer__link-item">Endre innholdet fra nettleseren</a></li><li class="footer__item"><a href="https://github.com/sikt-no/docs#editing-the-site-locally" target="_blank" rel="noopener noreferrer" class="footer__link-item">Endre innholdet lokalt</a></li><li class="footer__item"><a href="https://github.com/sikt-no/docs/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Opprette en issue i GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title">Kontaktinformasjon</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://sikt.no/kontakt-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kontakt oss</a></li><li class="footer__item"><a href="https://sikt.no/om-sikt" target="_blank" rel="noopener noreferrer" class="footer__link-item">Om Sikt</a></li><li class="footer__item"><a href="https://sikt.no/personvernerklaering" target="_blank" rel="noopener noreferrer" class="footer__link-item">Personvernerklæring</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/sikt_logo_white.svg" alt="Sikt Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="104" height="28"><img src="/img/sikt_logo_white.svg" alt="Sikt Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="104" height="28"></div><div class="footer__copyright">Copyright © 2025 Sikt – Kunnskapssektorens tjenesteleverandør</div></div></div></footer></div>
</body>
</html>