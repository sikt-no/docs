<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-iam/integrasjoner/Local_processing_aho" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Local Processing - AHO | Sikt teknisk dokumentasjon</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_aho"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Local Processing - AHO | Sikt teknisk dokumentasjon"><meta data-rh="true" name="description" content="G3LocalProcessing"><meta data-rh="true" property="og:description" content="G3LocalProcessing"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_aho"><link data-rh="true" rel="alternate" href="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_aho" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.sikt.no/docs/iam/integrasjoner/Local_processing_aho" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.210d0366.css">
<script src="/assets/js/runtime~main.52137bac.js" defer="defer"></script>
<script src="/assets/js/main.0fc6811f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/sikt_logo.svg" alt="Sikt logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/sikt_logo_white.svg" alt="Sikt logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">teknisk dokumentasjon</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iam/">Identitets og tilgangsstyring (Felles IAM)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iam/gevinster">Gevinster ved Felles IAM</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/iam/ansvar">Prosessinformasjon</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/iam/produkt">Produktinformasjon</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/iam/kontoaktivering">Brukerinformasjon</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iam/livssyklus">Livssyklus for identitet og tilgang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iam/brukernavn">Brukernavn og bruker-ID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iam/virksomhetsroller">Virksomhetsroller</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/iam/deputy">Funksjonsbeskrivelser</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iam/deputy">Deputy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iam/internal_processing_sikt">Internal Processing - Sikt</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/iam/integrasjoner/Local_processing_aho">Integrasjoner</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/iam/integrasjoner/Local_processing_aho">Local Processing - AHO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iam/integrasjoner/Local_Processing_hivolda">Local Processing - Høgskulen i Volda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iam/integrasjoner/Local_processing_nmbu">Local Processing - NMBU</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iam/referanser">Referanser</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Funksjonsbeskrivelser</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Integrasjoner</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Local Processing - AHO</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Local Processing - AHO</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="g3_local_processing">G3_Local_Processing<a href="#g3_local_processing" class="hash-link" aria-label="Direct link to G3_Local_Processing" title="Direct link to G3_Local_Processing">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptomoodle-on">PortalLdapToMoodle on<a href="#portalldaptomoodle-on" class="hash-link" aria-label="Direct link to PortalLdapToMoodle on" title="Direct link to PortalLdapToMoodle on">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description">Description<a href="#description" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script handles user provisioning and enrollment of courses per user to Moodle. It processes user records, performs necessary transformations, and updates or creates user accounts in Moodle. The script also handles enabling, disabling, and enrolling users in courses based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters">Input Parameters<a href="#input-parameters" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: Enum: <code>username</code>, <code>uh-username</code>, <code>uhid</code> (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>log_only</code>: Boolean</li>
<li><code>process_total</code>: Number (optional)</li>
<li><code>process_all</code>: Boolean (optional)</li>
<li><code>debug</code>: Boolean (optional)</li>
<li><code>arrUsersToProcess</code>: List of UHIDs to process. Usually passed on from PortalLdapToMoodle_Courses (optional)</li>
<li><code>portalldap_session</code>: Object (optional)</li>
<li><code>mv_session</code>: Object (optional)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables">Local Variables<a href="#local-variables" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchangedUser</code>, <code>totalAddUser</code>, <code>totalAddUserFail</code>, <code>totalUpdateUser</code>, <code>totalUpdateUserFail</code>, <code>totalDisableUser</code>, <code>totalDisableUserFail</code>, <code>totalUpdateCourses</code>, <code>totalUpdateCoursesFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>sessionMV</code>: Connection object for MV (RIDB).</li>
<li><code>cookie</code>: The cookie used for LDAP change tracking.</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>arrEntitlements</code>, <code>arrEntitlementsProvisioned</code>, <code>arrRequestedSystemEntitlements</code>, <code>arrRequestedEntitlementsProvisioned</code>: Arrays of system entitlements and provisioned entitlements for the user.</li>
<li><code>isEntitledToMoodle</code>: Boolean indicating if the user is entitled to Moodle.</li>
<li><code>selectedUsername</code>, <code>selectedEmail</code>: The username and email address selected for the user.</li>
<li><code>primaryAffiliation</code>: The primary affiliation of the user.</li>
<li><code>record</code>: The record formatted for provisioning to Moodle.</li>
<li><code>firstName</code>, <code>lastName</code>: The given name and surname of the user.</li>
<li><code>held_by</code>: The institution and student ID for the user.</li>
<li><code>arrCalculatedStudentCourses</code>, <code>arrCalculatedTeacherCourses</code>: Arrays of calculated courses for the user.</li>
<li><code>arrExistingCourses</code>: Array of existing courses for the user in Moodle.</li>
<li><code>arrAddCourses</code>, <code>arrCalculatedCourses</code>, <code>arrCoursesToRemove</code>: Arrays of courses to add, calculated courses, and courses to remove for the user.</li>
<li><code>courseShortname</code>, <code>term</code>, <code>year</code>, <code>course_id</code>, <code>role_id</code>: Variables for course details.</li>
<li><code>addCourseRecord</code>, <code>removeCourseRecord</code>: Records for adding and removing courses.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">Workflow<a href="#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP and MV.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Set Cookie</strong></li>
</ol>
<ul>
<li>Determine the appropriate cookie based on <code>log_only</code> parameter.</li>
</ul>
<ol start="4">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="5">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="6">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>username</code>, <code>email</code>, <code>idnumber</code>, <code>firstname</code>, <code>lastname</code>, <code>department</code>, etc.</li>
<li>Remove attributes that should not be provisioned to Moodle.</li>
</ul>
<ol start="7">
<li><strong>Match and Update Moodle</strong></li>
</ol>
<ul>
<li><strong>Check Existence in Moodle</strong>:<!-- -->
<ul>
<li>Check if the user exists in Moodle.</li>
<li>Handle errors and duplicate accounts.</li>
</ul>
</li>
<li><strong>Create New Account</strong>:<!-- -->
<ul>
<li>If the user does not exist in Moodle and is entitled to Moodle, create a new account.</li>
<li>Perform necessary data formation and set attributes.</li>
<li>Log the creation process and update Portal LDAP with provisioning status.</li>
</ul>
</li>
<li><strong>Update Existing Account</strong>:<!-- -->
<ul>
<li>If the user exists in Moodle, compare changes and update the account if necessary.</li>
<li>Handle enabling, disabling, and updating the account based on the user&#x27;s entitlements and changes.</li>
<li>Log the update process and update Portal LDAP with provisioning status if needed.</li>
</ul>
</li>
</ul>
<ol start="8">
<li><strong>Enroll in Courses</strong></li>
</ol>
<ul>
<li>Calculate and update the user&#x27;s entitled courses, including role type.</li>
<li>Fetch the existing user&#x27;s courses from Moodle.</li>
<li>Calculate which courses to add and remove based on the user&#x27;s entitlements.</li>
<li>Log the enrollment process and handle any errors.</li>
</ul>
<ol start="9">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP and MV.</li>
</ul>
<ol start="10">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the synchronization process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications">External Systems and Communications<a href="#external-systems-and-communications" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
<li><strong>MV (RIDB)</strong>: Used to query user roles and affiliations.</li>
<li><strong>Moodle</strong>: The target system where user accounts are created, updated, enabled, disabled, and enrolled in courses.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs">Response Codes/Outputs<a href="#response-codesoutputs" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>Return a <code>200 OK</code> response if the operation to update Moodle was successful.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script synchronizes user data from a portal directory to Moodle. It handles various operations such as creating, updating, enabling, disabling, and enrolling users in courses based on specific conditions. The script ensures data consistency and logs detailed results of the synchronization process.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptolenel-on">PortalLdapToLenel on<a href="#portalldaptolenel-on" class="hash-link" aria-label="Direct link to PortalLdapToLenel on" title="Direct link to PortalLdapToLenel on">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-1">Description<a href="#description-1" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script synchronizes user data from a portal directory to Lenel via API. It processes user records, performs necessary transformations, and updates or creates user accounts in Lenel. The script also handles enabling, disabling, renaming, and moving user accounts based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-1">Input Parameters<a href="#input-parameters-1" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: Enum: <code>username</code>, <code>uh-username</code>, <code>idautoID</code> (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>process_total</code>: Number (optional)</li>
<li><code>log_only</code>: Boolean (optional)</li>
<li><code>process_all</code>: Boolean (optional)</li>
<li><code>debug</code>: Boolean (optional)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-1">Local Variables<a href="#local-variables-1" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdd</code>, <code>totalAddFail</code>, <code>totalUpdate</code>, <code>totalUpdateFail</code>, <code>totalRename</code>, <code>totalRenameFail</code>, <code>totalDisable</code>, <code>totalDisableFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>sessionMV</code>: Connection object for MV (RIDB).</li>
<li><code>lenelSessionToken</code>: Session token for Lenel API.</li>
<li><code>headers</code>: HTTP headers for API requests.</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>arrEntitlements</code>, <code>arrEntitlementsProvisioned</code>, <code>arrRequestedSystemEntitlements</code>, <code>arrRequestedEntitlementsProvisioned</code>, <code>arrBusinessRoles</code>: Arrays of system entitlements and provisioned entitlements for the user.</li>
<li><code>isEntitledToLenel</code>: Boolean indicating if the user is entitled to Lenel.</li>
<li><code>selectedUsername</code>: The username selected for the user.</li>
<li><code>selectedEmail</code>: The email address selected for the user.</li>
<li><code>primaryAffiliation</code>: The primary affiliation of the user.</li>
<li><code>record</code>: The record formatted for provisioning to Lenel.</li>
<li><code>exists</code>: Boolean indicating if the user exists in Lenel.</li>
<li><code>recordLenel</code>: The Lenel record of the user.</li>
<li><code>arrBadges</code>: Array of badges for the user.</li>
<li><code>arrExistingAccessZones</code>, <code>arrAccessLevels</code>, <code>arrCalculatedAccessZones</code>, <code>arrAccessZonesToAdd</code>, <code>arrAccessZonesToRemove</code>: Arrays for managing access zones.</li>
<li><code>accessZoneUpdateSuccessful</code>: Boolean indicating if the access zone update was successful.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-1">Workflow<a href="#workflow-1" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP, MV, and Lenel.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Set Cookie</strong></li>
</ol>
<ul>
<li>Determine the appropriate cookie based on <code>log_only</code> parameter.</li>
</ul>
<ol start="4">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="5">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="6">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>firstname</code>, <code>lastname</code>, <code>ssno</code>, <code>ext</code>, etc.</li>
<li>Remove attributes that should not be provisioned to Lenel.</li>
</ul>
<ol start="7">
<li><strong>Match and Update Lenel</strong></li>
</ol>
<ul>
<li><strong>Check Existence in Lenel</strong>:<!-- -->
<ul>
<li>Check if the user exists in Lenel.</li>
<li>Handle errors and duplicate accounts.</li>
</ul>
</li>
<li><strong>Create New Account</strong>:<!-- -->
<ul>
<li>If the user does not exist in Lenel and is entitled to Lenel, create a new account.</li>
<li>Perform necessary data formation and set attributes.</li>
<li>Log the creation process and update Portal LDAP with provisioning status.</li>
</ul>
</li>
<li><strong>Update Existing Account</strong>:<!-- -->
<ul>
<li>If the user exists in Lenel, compare changes and update the account if necessary.</li>
<li>Handle enabling, disabling, moving, and renaming of the account based on the user&#x27;s entitlements and changes.</li>
<li>Log the update process and update Portal LDAP with provisioning status if needed.</li>
</ul>
</li>
</ul>
<ol start="8">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP and MV.</li>
</ul>
<ol start="9">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the synchronization process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-1">External Systems and Communications<a href="#external-systems-and-communications-1" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
<li><strong>MV (RIDB)</strong>: Used to query user roles and affiliations.</li>
<li><strong>Lenel</strong>: The target system where user accounts are created, updated, enabled, disabled, moved, and renamed.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-1">Response Codes/Outputs<a href="#response-codesoutputs-1" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>Return a <code>true</code> value if the operation was successful.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-1">Summary<a href="#summary-1" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script synchronizes user data from a portal directory to Lenel via API. It handles various operations such as creating, updating, enabling, disabling, moving, and renaming user accounts based on specific conditions. The script ensures data consistency and logs detailed results of the synchronization process.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptomoodle_courses-on">PortalLdapToMoodle_Courses on<a href="#portalldaptomoodle_courses-on" class="hash-link" aria-label="Direct link to PortalLdapToMoodle_Courses on" title="Direct link to PortalLdapToMoodle_Courses on">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-2">Description<a href="#description-2" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script handles the provisioning of courses to Moodle. It first builds the category hierarchy and then populates the different courses. The script also processes users related to the courses that have been created in Moodle.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-2">Input Parameters<a href="#input-parameters-2" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>source_id</code> (optional, string): Iterate a single course from <code>master_topics</code>. Format: <code>institution:code:version</code>.</li>
<li><code>log_only</code> (boolean): If true, the script will only log actions without making changes.</li>
<li><code>skip_users</code> (boolean): If true, the script will skip reprocessing users related to the course.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-2">Local Variables<a href="#local-variables-2" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalAdd</code>, <code>totalAddFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>moodleUrl</code>, <code>institution</code>, <code>this_year</code>, <code>this_month</code>: Configuration variables for Moodle and the current date.</li>
<li><code>arrCoursesToReprocess</code>, <code>arrSemesters</code>, <code>arrExistingEmnetyper</code>, <code>arrUsersToReprocess</code>: Arrays for storing courses, semesters, existing course types, and users to reprocess.</li>
<li><code>sessionPortalLDAP</code>, <code>sessionMV</code>: Connection objects for Portal LDAP and MetaVault (RIDB).</li>
<li><code>token</code>: The access token fetched from Moodle.</li>
<li><code>standardTemplateName</code>, <code>standardTemplateID</code>: Variables for the standard course template in Moodle.</li>
<li><code>current_semester</code>, <code>semester</code>, <code>current_semester_name</code>, <code>current_semester_id</code>, <code>year</code>: Variables for the current semester and year.</li>
<li><code>courseShortName</code>, <code>courseIdNumber</code>, <code>courseCategoryID</code>, <code>courseStartDate</code>, <code>courseEndDate</code>: Variables for course details.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-2">Workflow<a href="#workflow-2" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li>
<p><strong>Initialize Variables</strong></p>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
</li>
<li>
<p><strong>Create Connections</strong></p>
<ul>
<li>Establish connections to Portal LDAP and MetaVault (RIDB).</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
</li>
<li>
<p><strong>Fetch Access Token from Moodle</strong></p>
<ul>
<li>Make an HTTP POST request to fetch the access token from Moodle.</li>
<li>Handle errors if the token fetch fails.</li>
</ul>
</li>
<li>
<p><strong>Fetch Standard Template for Courses</strong></p>
<ul>
<li>Fetch the standard template for a course from Moodle.</li>
<li>Handle errors if the template fetch fails.</li>
</ul>
</li>
<li>
<p><strong>Calculate Semesters to Process</strong></p>
<ul>
<li>Determine if only the current semester or the next semester should be processed based on the current month.</li>
<li>Append the calculated semesters to <code>arrSemesters</code>.</li>
</ul>
</li>
<li>
<p><strong>Iterate Through Semesters</strong></p>
<ul>
<li>For each semester, reset variables and verify that the categories exist in Moodle.</li>
<li>Create top-level and sub-level categories based on the semester and course types.</li>
</ul>
</li>
<li>
<p><strong>Create Courses</strong></p>
<ul>
<li>Query <code>master_topics</code> to fetch relevant courses.</li>
<li>For each course, check if it already exists in Moodle.</li>
<li>If the course does not exist, create it in Moodle and insert the standard template.</li>
<li>Handle errors and log actions accordingly.</li>
</ul>
</li>
<li>
<p><strong>Process Users Related to Courses</strong></p>
<ul>
<li>If <code>skip_users</code> is false, reprocess users related to the courses that have been created in Moodle.</li>
<li>Fetch users from <code>master_persons</code> and reprocess them.</li>
</ul>
</li>
<li>
<p><strong>Close Connections</strong></p>
<ul>
<li>Close all established connections to Portal LDAP and MetaVault (RIDB).</li>
</ul>
</li>
<li>
<p><strong>Log Results</strong></p>
</li>
</ol>
<ul>
<li>Log the results of the provisioning process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-2">External Systems and Communications<a href="#external-systems-and-communications-2" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Moodle</strong>: The script interacts with the Moodle API to create categories and courses, and to fetch the access token and standard template.</li>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
<li><strong>MetaVault (RIDB)</strong>: Used to query course and user data.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-2">Response Codes/Outputs<a href="#response-codesoutputs-2" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>The script returns <code>true</code> if the provisioning process is successful, and <code>false</code> otherwise.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-2">Summary<a href="#summary-2" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script provisions courses to Moodle by building the category hierarchy and populating the courses. It handles various operations such as creating categories, fetching templates, and processing users related to the courses. The script ensures data consistency and logs detailed results of the provisioning process.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptoad-on">PortalLdapToAD on<a href="#portalldaptoad-on" class="hash-link" aria-label="Direct link to PortalLdapToAD on" title="Direct link to PortalLdapToAD on">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-3">Description<a href="#description-3" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script synchronizes user data from a portal directory to Active Directory (AD). It processes user records, performs necessary transformations, and updates or creates user accounts in AD. The script also handles enabling, disabling, renaming, and moving user accounts based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-3">Input Parameters<a href="#input-parameters-3" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: Enum: <code>username</code>, <code>uh-username</code>, <code>idautoID</code> (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>process_total</code>: Number (optional)</li>
<li><code>log_only</code>: Boolean (optional)</li>
<li><code>process_all</code>: Boolean (optional)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-3">Local Variables<a href="#local-variables-3" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>fileDate</code>: The current date formatted as <code>yyyyMMdd</code>.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdd</code>, <code>totalAddFail</code>, <code>totalUpdate</code>, <code>totalUpdateFail</code>, <code>totalRename</code>, <code>totalRenameFail</code>, <code>totalEnable</code>, <code>totalEnableFail</code>, <code>totalDisable</code>, <code>totalDisableFail</code>, <code>totalMove</code>, <code>totalMoveFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>sessionPortal</code>: Connection object for Cloud Portal.</li>
<li><code>sessionMV</code>: Connection object for MV (RIDB).</li>
<li><code>sessionAD</code>: Connection object for Active Directory.</li>
<li><code>cookie</code>: The cookie used for LDAP change tracking.</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>arrSystemEntitlements</code>, <code>arrSystemEntitlementsProvisioned</code>: Arrays of system entitlements and provisioned entitlements for the user.</li>
<li><code>isEntitledToAD</code>: Boolean indicating if the user is entitled to AD.</li>
<li><code>isProvisionedToAD</code>: Boolean indicating if the user is provisioned to AD.</li>
<li><code>selectedUsername</code>: The username selected for the user.</li>
<li><code>selectedEmail</code>: The email address selected for the user.</li>
<li><code>hasReservationFlag</code>: Boolean indicating if the user has a reservation flag.</li>
<li><code>title</code>: The job title of the user.</li>
<li><code>affiliation</code>: The affiliation of the user.</li>
<li><code>primaryAffiliation</code>: The primary affiliation of the user.</li>
<li><code>record</code>: The record formatted for provisioning to AD.</li>
<li><code>cn</code>: The common name of the user.</li>
<li><code>orgLevels</code>: Organizational levels fetched from MV.</li>
<li><code>orgLevel</code>: The formatted organizational level.</li>
<li><code>stedkode</code>: The location code.</li>
<li><code>arrBusinessroles</code>: Array of business roles for the user.</li>
<li><code>extensionAttribute1</code>: The extension attribute for the user.</li>
<li><code>departmentNumber</code>: The department number for the user.</li>
<li><code>givenName</code>, <code>sn</code>: The given name and surname of the user.</li>
<li><code>fullNameEmailAddress</code>: The full name email address for the user.</li>
<li><code>fneaCreated</code>: Boolean indicating if the full name email address was created.</li>
<li><code>recordManager</code>: The LDAP record of the user&#x27;s manager.</li>
<li><code>managerUsername</code>: The username of the user&#x27;s manager.</li>
<li><code>recordADManagers</code>: The AD records of the user&#x27;s manager.</li>
<li><code>arrFieldNames</code>: Array of field names in the record.</li>
<li><code>exists</code>: Boolean indicating if the user exists in AD.</li>
<li><code>adRecord</code>: The AD record of the user.</li>
<li><code>arrProxyAddresses</code>: Array of proxy addresses for the user.</li>
<li><code>passwordPolicy</code>: The password policy ID.</li>
<li><code>password</code>: The generated password for the user.</li>
<li><code>extProperties</code>: Extended properties for the user.</li>
<li><code>changes</code>: The changes detected in the record.</li>
<li><code>fieldNames</code>: The field names of the changes.</li>
<li><code>isDisabledInAD</code>: Boolean indicating if the user is disabled in AD.</li>
<li><code>currentPlacement</code>, <code>newPlacement</code>: The current and new placements of the user in AD.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-3">Workflow<a href="#workflow-3" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP, Cloud Portal, MV, and AD.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Set Cookie</strong></li>
</ol>
<ul>
<li>Determine the appropriate cookie based on <code>log_only</code> parameter.</li>
</ul>
<ol start="4">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="5">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="6">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>cn</code>, <code>employeeType</code>, <code>department</code>, <code>title</code>, etc.</li>
<li>Remove attributes that should not be provisioned to AD.</li>
</ul>
<ol start="7">
<li><strong>Match and Update AD</strong></li>
</ol>
<ul>
<li><strong>Check Existence in AD</strong>:<!-- -->
<ul>
<li>Check if the user exists in AD.</li>
<li>Handle errors and duplicate accounts.</li>
</ul>
</li>
<li><strong>Create New Account</strong>:<!-- -->
<ul>
<li>If the user does not exist in AD and is entitled to AD, create a new account.</li>
<li>Perform necessary data formation and set attributes.</li>
<li>Log the creation process and update Portal LDAP with provisioning status.</li>
</ul>
</li>
<li><strong>Update Existing Account</strong>:<!-- -->
<ul>
<li>If the user exists in AD, compare changes and update the account if necessary.</li>
<li>Handle enabling, disabling, moving, and renaming of the account based on the user&#x27;s entitlements and changes.</li>
<li>Log the update process and update Portal LDAP with provisioning status if needed.</li>
</ul>
</li>
</ul>
<ol start="8">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP, Cloud Portal, MV, and AD.</li>
</ul>
<ol start="9">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the synchronization process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-3">External Systems and Communications<a href="#external-systems-and-communications-3" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
<li><strong>Cloud Portal</strong>: Used to fetch password policies and generate passwords.</li>
<li><strong>MV (RIDB)</strong>: Used to query organizational levels.</li>
<li><strong>Active Directory (AD)</strong>: The target system where user accounts are created, updated, enabled, disabled, moved, and renamed.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codes">Response Codes<a href="#response-codes" class="hash-link" aria-label="Direct link to Response Codes" title="Direct link to Response Codes">​</a></h4>
<ul>
<li>None explicitly mentioned.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-3">Summary<a href="#summary-3" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script synchronizes user data from a portal directory to Active Directory. It handles various operations such as creating, updating, enabling, disabling, moving, and renaming user accounts based on specific conditions. The script ensures data consistency and logs detailed results of the synchronization process.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="portalldaptowiseflow">PortalLdapToWISEflow<a href="#portalldaptowiseflow" class="hash-link" aria-label="Direct link to PortalLdapToWISEflow" title="Direct link to PortalLdapToWISEflow">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-4">Description<a href="#description-4" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>This script provisions users and roles to WISEflow. It processes user records from a portal directory, performs necessary transformations, and updates or creates user accounts in WISEflow. The script also handles enabling, disabling, and updating user roles based on specific conditions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-parameters-4">Input Parameters<a href="#input-parameters-4" class="hash-link" aria-label="Direct link to Input Parameters" title="Direct link to Input Parameters">​</a></h4>
<ul>
<li><code>key_field</code>: String (optional)</li>
<li><code>key_value</code>: String (optional)</li>
<li><code>log_only</code>: Boolean (optional)</li>
<li><code>debug</code>: Boolean (optional)</li>
<li><code>process_all</code>: Boolean (optional)</li>
<li><code>load</code>: Boolean</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-variables-4">Local Variables<a href="#local-variables-4" class="hash-link" aria-label="Direct link to Local Variables" title="Direct link to Local Variables">​</a></h4>
<ul>
<li><code>fnr</code>, <code>feideID</code>, <code>pln</code>: Local user data types.</li>
<li><code>rolesToProvision</code>: Array of roles that RI is allowed to provision/deprovision.</li>
<li><code>langMap</code>: Mapping of languages to their respective codes.</li>
<li><code>actionSetName</code>: The name of the current action set.</li>
<li><code>total</code>, <code>totalSkipped</code>, <code>totalUnchanged</code>, <code>totalAdd</code>, <code>totalAddFail</code>, <code>totalUpdate</code>, <code>totalUpdateFail</code>, <code>totalEnable</code>, <code>totalEnableFail</code>, <code>totalDisable</code>, <code>totalDisableFail</code>: Counters for tracking various operations and their outcomes.</li>
<li><code>policyFile</code>: The policy file for WISEflow ruleset.</li>
<li><code>processedAccounts</code>: Array to keep track of processed accounts.</li>
<li><code>targetSystem</code>: The target system, which is WISEflow.</li>
<li><code>sessionPortalLDAP</code>: Connection object for Portal LDAP.</li>
<li><code>arrAllRoles</code>: Array of all roles retrieved from WISEflow.</li>
<li><code>cookie</code>: The cookie used for LDAP change tracking.</li>
<li><code>recordChanges</code>: The set of records fetched from Portal LDAP.</li>
<li><code>recordChange</code>: The current record being processed.</li>
<li><code>recordLDAP</code>: Detailed LDAP record of the current user.</li>
<li><code>isAssignedReq</code>, <code>isProvisionedReq</code>: Booleans indicating if the user is assigned or provisioned for the target system.</li>
<li><code>arrTargetSystemAssignedReq</code>, <code>arrTargetSystemProvisionedReq</code>: Arrays of assigned and provisioned requests for the target system.</li>
<li><code>isDisabled</code>: Boolean indicating if the user is disabled.</li>
<li><code>arrEmails</code>, <code>arrEmailsToAdd</code>, <code>arrEmailsToRemove</code>, <code>arrayEmailsRemoved</code>, <code>arrayEmailsFailedToRemove</code>: Arrays for managing user emails.</li>
<li><code>arrExternalIDs</code>, <code>arrExtIDsToAdd</code>, <code>arrExtIDsToRemove</code>, <code>arrExtIDSRemoved</code>, <code>arrExtIDSFailedToRemove</code>: Arrays for managing user external IDs.</li>
<li><code>arrBusRoles</code>: Array of business roles for the user.</li>
<li><code>isExternalSensor</code>: Boolean indicating if the user is an external sensor.</li>
<li><code>hasFnrChanged</code>, <code>hasFnr</code>: Booleans indicating if the user&#x27;s national ID has changed or exists.</li>
<li><code>selectedUsername</code>: The username selected for the user.</li>
<li><code>primaryEmail</code>, <code>secondaryEmail</code>: The primary and secondary email addresses for the user.</li>
<li><code>arrEmailObjects</code>: Array of email objects for the user.</li>
<li><code>preferred_language</code>: The preferred language of the user.</li>
<li><code>recordePPNIdentifier</code>, <code>recordBirthnumberIdentifier</code>, <code>recordFSIdentifier</code>: Records for external IDs.</li>
<li><code>authorizedAccesses</code>, <code>arrayAuthorizedAccesses</code>: Authorized accesses for the user.</li>
<li><code>arrRoles</code>: Array of roles for the user.</li>
<li><code>exists</code>, <code>baseObject</code>: Objects for checking if the user exists in WISEflow.</li>
<li><code>isLoginDeactivated</code>, <code>existingPreferredLanguage</code>: Booleans and strings for managing user login status and preferred language.</li>
<li><code>recordUpdate</code>, <code>recordRemove</code>: Records for updating and removing user data in Portal LDAP.</li>
<li><code>oldRoles</code>, <code>arrOldEmails</code>, <code>existingPrimaryEmail</code>, <code>existingOtherEmails</code>, <code>existingOtherEmailsArr</code>: Arrays and objects for managing existing user roles and emails.</li>
<li><code>arrOldExtIds</code>, <code>arrNewRoles</code>, <code>arrNewExtIds</code>: Arrays for managing existing and new user roles and external IDs.</li>
<li><code>recordCheckChangeNew</code>, <code>recordCheckChangeOld</code>: Records for checking changes in user data.</li>
<li><code>hasBaseRecordChanged</code>, <code>hasRolesChanged</code>, <code>hasExternalIdsChanged</code>, <code>hasEmailChanged</code>: Booleans indicating if the base record, roles, external IDs, or emails have changed.</li>
<li><code>arrRolesToAdd</code>, <code>arrRolesToRemove</code>: Arrays for managing roles to add or remove.</li>
<li><code>arrPatchExtID</code>, <code>arrPatchClean</code>: Arrays for managing external IDs to patch.</li>
<li><code>arrExtIDsToAdd</code>, <code>arrExtIDsToRemove</code>: Arrays for managing external IDs to add or remove.</li>
<li><code>arrEmailsToAdd</code>, <code>arrEmailsToRemove</code>: Arrays for managing emails to add or remove.</li>
<li><code>isUpdateSuccessful</code>: Boolean indicating if the update was successful.</li>
<li><code>recordUpdateWf</code>, <code>recordDisableWf</code>: Records for updating and disabling user data in WISEflow.</li>
<li><code>extCreate</code>, <code>extPutRecord</code>, <code>extDisableRecord</code>, <code>extLDAPUpdate</code>: Extended properties for logging audit events.</li>
<li><code>resultAddRoles</code>, <code>resultRemoveRole</code>, <code>resultPostEmails</code>, <code>resultPatchPrimaryEmail</code>, <code>resultPatchExtId</code>, <code>resultDeleteExtIDs</code>, <code>resultPostExtIDs</code>: Results of various operations.</li>
<li><code>arrRemovedRoles</code>, <code>arrRolesFailedToRemove</code>, <code>arrExtIDSRemoved</code>, <code>arrExtIDSFailedToRemove</code>: Arrays for managing removed roles and external IDs.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-4">Workflow<a href="#workflow-4" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h4>
<ol>
<li><strong>Initialize Variables</strong></li>
</ol>
<ul>
<li>Set initial values for counters and other variables.</li>
<li>Adjust <code>key_field</code> and <code>key_value</code> based on input parameters.</li>
</ul>
<ol start="2">
<li><strong>Create Connections</strong></li>
</ol>
<ul>
<li>Establish connections to Portal LDAP.</li>
<li>Handle connection errors by logging and invoking <code>G3_ErrorHandler</code>.</li>
</ul>
<ol start="3">
<li><strong>Retrieve Roles from WISEflow</strong></li>
</ol>
<ul>
<li>Fetch all roles from WISEflow and handle errors if any.</li>
</ul>
<ol start="4">
<li><strong>Set Cookie</strong></li>
</ol>
<ul>
<li>Determine the appropriate cookie based on <code>log_only</code> parameter.</li>
</ul>
<ol start="5">
<li><strong>Query Records</strong></li>
</ol>
<ul>
<li>Fetch records from Portal LDAP based on <code>key_field</code> and <code>key_value</code>.</li>
<li>If no specific key is provided, use a change iterator to fetch records.</li>
</ul>
<ol start="6">
<li><strong>Iterate Over Records</strong></li>
</ol>
<ul>
<li>For each record, skip if the change type is &quot;delete&quot;.</li>
<li>Fetch detailed LDAP record and skip if essential attributes are missing.</li>
<li>Determine user entitlements and provisioning status.</li>
<li>Log processing information.</li>
</ul>
<ol start="7">
<li><strong>Transform Record</strong></li>
</ol>
<ul>
<li>Perform static and dynamic transformations on the record.</li>
<li>Set various attributes like <code>firstName</code>, <code>lastName</code>, <code>emails</code>, <code>phone</code>, <code>preferred_language</code>, <code>externalIds</code>, etc.</li>
</ul>
<ol start="8">
<li><strong>Access Logic</strong></li>
</ol>
<ul>
<li>Determine authorized accesses for the user based on the policy file.</li>
<li>Append accesses to the record.</li>
</ul>
<ol start="9">
<li><strong>Query System for User</strong></li>
</ol>
<ul>
<li>Check if the user exists in WISEflow using various identifiers.</li>
<li>Handle errors and duplicate accounts.</li>
</ul>
<ol start="10">
<li><strong>Create or Update User</strong></li>
</ol>
<ul>
<li><strong>Create New User</strong>:<!-- -->
<ul>
<li>If the user does not exist in WISEflow and is assigned or requested, create a new user.</li>
<li>Log the creation process and update Portal LDAP with provisioning status.</li>
</ul>
</li>
<li><strong>Update or Disable User</strong>:<!-- -->
<ul>
<li>If the user exists in WISEflow, compare changes and update the account if necessary.</li>
<li>Handle enabling, disabling, and updating roles, emails, and external IDs based on the user&#x27;s entitlements and changes.</li>
<li>Log the update process and update Portal LDAP with provisioning status if needed.</li>
</ul>
</li>
</ul>
<ol start="11">
<li><strong>Update Portal LDAP</strong></li>
</ol>
<ul>
<li>Update or remove user data in Portal LDAP based on the changes made in WISEflow.</li>
<li>Log the update process and handle errors if any.</li>
</ul>
<ol start="12">
<li><strong>Close Connections</strong></li>
</ol>
<ul>
<li>Close all established connections to Portal LDAP.</li>
</ul>
<ol start="13">
<li><strong>Log Results</strong></li>
</ol>
<ul>
<li>Log the results of the provisioning process, including totals for each operation and failures.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-systems-and-communications-4">External Systems and Communications<a href="#external-systems-and-communications-4" class="hash-link" aria-label="Direct link to External Systems and Communications" title="Direct link to External Systems and Communications">​</a></h4>
<ul>
<li><strong>WISEflow</strong>: The script interacts with the WISEflow API to perform user provisioning, updating, and disabling. The primary endpoints used are for retrieving roles, creating users, updating users, and managing user roles, emails, and external IDs.</li>
<li><strong>Portal LDAP</strong>: Used to fetch user records and update user attributes.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="response-codesoutputs-3">Response Codes/Outputs<a href="#response-codesoutputs-3" class="hash-link" aria-label="Direct link to Response Codes/Outputs" title="Direct link to Response Codes/Outputs">​</a></h4>
<ul>
<li>None explicitly mentioned.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-4">Summary<a href="#summary-4" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4>
<p>This script provisions users and roles to WISEflow by processing user records from a portal directory, performing necessary transformations, and updating or creating user accounts in WISEflow. It handles various operations such as enabling, disabling, and updating user roles, emails, and external IDs based on specific conditions. The script ensures data consistency and logs detailed results of the provisioning process.</p>
<hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/sikt-no/docs/tree/master/docs/iam/integrasjoner/Local_processing_aho.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-03-17T14:12:52.000Z" itemprop="dateModified">Mar 17, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/iam/internal_processing_sikt"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Internal Processing - Sikt</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/iam/integrasjoner/Local_Processing_hivolda"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Local Processing - Høgskulen i Volda</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#g3_local_processing" class="table-of-contents__link toc-highlight">G3_Local_Processing</a><ul><li><a href="#portalldaptomoodle-on" class="table-of-contents__link toc-highlight">PortalLdapToMoodle on</a></li><li><a href="#portalldaptolenel-on" class="table-of-contents__link toc-highlight">PortalLdapToLenel on</a></li><li><a href="#portalldaptomoodle_courses-on" class="table-of-contents__link toc-highlight">PortalLdapToMoodle_Courses on</a></li><li><a href="#portalldaptoad-on" class="table-of-contents__link toc-highlight">PortalLdapToAD on</a></li><li><a href="#portalldaptowiseflow" class="table-of-contents__link toc-highlight">PortalLdapToWISEflow</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Sikt Docs</div><ul class="footer__items clean-list"><li class="footer__item"><p>Teknisk dokumentasjon på fellesløsningene Sikt leverer for utdanning og forskning.</p></li></ul></div><div class="col footer__col"><div class="footer__title">Hvordan bidra?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sikt-no/docs#editing-the-site-directly-from-the-web-browser" target="_blank" rel="noopener noreferrer" class="footer__link-item">Endre innholdet fra nettleseren</a></li><li class="footer__item"><a href="https://github.com/sikt-no/docs#editing-the-site-locally" target="_blank" rel="noopener noreferrer" class="footer__link-item">Endre innholdet lokalt</a></li><li class="footer__item"><a href="https://github.com/sikt-no/docs/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Opprette en issue i GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title">Kontaktinformasjon</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://sikt.no/kontakt-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kontakt oss</a></li><li class="footer__item"><a href="https://sikt.no/om-sikt" target="_blank" rel="noopener noreferrer" class="footer__link-item">Om Sikt</a></li><li class="footer__item"><a href="https://sikt.no/personvernerklaering" target="_blank" rel="noopener noreferrer" class="footer__link-item">Personvernerklæring</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/sikt_logo_white.svg" alt="Sikt Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="104" height="28"><img src="/img/sikt_logo_white.svg" alt="Sikt Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="104" height="28"></div><div class="footer__copyright">Copyright © 2025 Sikt – Kunnskapssektorens tjenesteleverandør</div></div></div></footer></div>
</body>
</html>