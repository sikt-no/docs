"use strict";(self.webpackChunkdocs_sikt_no=self.webpackChunkdocs_sikt_no||[]).push([[7555],{7027:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var r=t(5893),i=t(1151);const s={description:"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]\n\n\nHvordan du kan sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon.",title:"Konfigurere autentisering via maskinporten "},a="Konfigurere autentisering via maskinporten",l={id:"datadeling/veiledere/api-manager/maskinporten-autentisering",title:"Konfigurere autentisering via maskinporten ",description:"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]\n\n\nHvordan du kan sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon.",source:"@site/docs/datadeling/veiledere/api-manager/maskinporten-autentisering.md",sourceDirName:"datadeling/veiledere/api-manager",slug:"/datadeling/veiledere/api-manager/maskinporten-autentisering",permalink:"/docs/datadeling/veiledere/api-manager/maskinporten-autentisering",draft:!1,unlisted:!1,editUrl:"https://github.com/sikt-no/docs/tree/master/docs/datadeling/veiledere/api-manager/maskinporten-autentisering.md",tags:[],version:"current",lastUpdatedAt:1706018448,formattedLastUpdatedAt:"Jan 23, 2024",frontMatter:{description:"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]\n\n\nHvordan du kan sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon.",title:"Konfigurere autentisering via maskinporten "},sidebar:"datadeling",previous:{title:"Legge p\xe5 en enkel policy (IP filter)",permalink:"/docs/datadeling/veiledere/api-manager/legge-pa-enkel-policy"},next:{title:"Opprette plan",permalink:"/docs/datadeling/veiledere/api-manager/opprette-plan"}},o={},d=[{value:"Bakgrunn",id:"bakgrunn",level:3},{value:"Forutsetninger",id:"forutsetninger",level:3},{value:"Registrer API i Maskinporten",id:"registrer-api-i-maskinporten",level:3},{value:"Registrer API-et",id:"registrer-api-et",level:3},{value:"Registrere applikasjon",id:"registrere-applikasjon",level:3}];function g(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"konfigurere-autentisering-via-maskinporten",children:"Konfigurere autentisering via maskinporten"}),"\n",(0,r.jsx)(n.p,{children:"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]"}),"\n",(0,r.jsx)(n.p,{children:"Hvordan du kan sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon."}),"\n",(0,r.jsx)(n.h3,{id:"bakgrunn",children:"Bakgrunn"}),"\n",(0,r.jsx)(n.p,{children:"Maskinporten kan brukes til sikker autentisering mot API p\xe5 tvers av organisasjoner."}),"\n",(0,r.jsx)(n.p,{children:"N\xe5r man bruker maskinporten autentiserer man seg f\xf8rst mot maskinporten med et sertifikat. Som svar f\xe5r man et tilgans-token, som igjen brukes til autorisasjon i API Gatewayen."}),"\n",(0,r.jsx)(n.h3,{id:"forutsetninger",children:"Forutsetninger"}),"\n",(0,r.jsx)(n.p,{children:"Det forutsettes at organisasjonen din er registrert som bruker av maskinporten og har f\xe5tt opprettet et prefiks."}),"\n",(0,r.jsx)(n.h3,{id:"registrer-api-i-maskinporten",children:"Registrer API i Maskinporten"}),"\n",(0,r.jsx)(n.p,{children:"F\xf8rst m\xe5 API-et registreres i maskinporten. Da opprettes det et scope. Et scope kan brukes til \xe5 gi tilganger til ressurser i et eller flere API. Det anbefales \xe5 ikke bruke samme scope for \xe5 gi tilgang til ulike API."}),"\n",(0,r.jsx)(n.p,{children:"I tillegg m\xe5 de organisasjonene som skal f\xe5 tilgang til API-et bli gitt tilgang. Dette kan gj\xf8res b\xe5de f\xf8r og etter at API-et er registrert i API Gateway."}),"\n",(0,r.jsx)(n.h3,{id:"registrer-api-et",children:"Registrer API-et"}),"\n",(0,r.jsxs)(n.p,{children:["Om det ikke allerede er registrert. Om det ikke allerede er gjort finnes det ",(0,r.jsx)(n.a,{href:"/docs/datadeling/veiledere/api-manager/api-manager-registrere-enkelt-api",children:"veiledning her"}),". Kom tilbake til denne siden n\xe5r planer skal opprettes."]}),"\n",(0,r.jsx)(n.p,{children:"Opprett plan med sikret med JWT"}),"\n",(0,r.jsx)(n.p,{children:"Et tilgans-token er en type token som kalles Java Web Token, forkortet JWT (uttales jot eller j\xe5t)."}),"\n",(0,r.jsx)(n.p,{children:"Opprett en ny plan ved \xe5 g\xe5 til API-et, velg Plans og trykk p\xe5 plusstegnet"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"webside for \xe5 opprette planer",src:t(5592).Z+"",width:"838",height:"374"})}),"\n",(0,r.jsx)(n.p,{children:"Skriv inn navn og en beskrivelse av planen. G\xe5 til neste side."}),"\n",(0,r.jsx)(n.p,{children:"P\xe5 siden for Secure, under Authentication velg JWT som Authentication type."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Meny for vinduet Secure",src:t(7555).Z+"",width:"1688",height:"1205"})}),"\n",(0,r.jsxs)(n.p,{children:["Videre skal f\xf8lgende legges til under Configuration.\nI menyen for ",(0,r.jsx)(n.strong,{children:"Signature"})," la RS256 v\xe6re valgt (det er eneste som st\xf8ttes av maskinporten p.t.)."]}),"\n",(0,r.jsxs)(n.p,{children:["I menyen ",(0,r.jsx)(n.strong,{children:"JWKS Resolver"}),", velg JWKS_URL."]}),"\n",(0,r.jsxs)(n.p,{children:["I ",(0,r.jsx)(n.strong,{children:"Resolver parameter"})," skriv eller lim inn URL hvor API Gatewayen kan finne maskinportens offentlige sertifikat. I produksjon er dette ",(0,r.jsx)(n.a,{href:"https://maskinporten.no/jwk",children:"https://maskinporten.no/jwk"})," , i test er det ",(0,r.jsx)(n.a,{href:"https://ver2.maskinporten.no/jwk",children:"https://ver2.maskinporten.no/jwk"})," eller ",(0,r.jsx)(n.a,{href:"https://ver1.maskinporten.no/jwk",children:"https://ver1.maskinporten.no/jwk"})," , alt etter hvilket testmilj\xf8 man benytter."]}),"\n",(0,r.jsxs)(n.p,{children:["Om du vil kunne bruke informasjon fra tokenet til flere sjekker og/eller i policyer, huk av for ",(0,r.jsx)(n.strong,{children:"Extract JWT Claims"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Det er god praksis \xe5 sjekke autorisasjonen som er gitt b\xe5de i API gateway og i selve API-et. Med mindre du ikke stoler p\xe5 API-et eller det er for testing, lar du ",(0,r.jsx)(n.strong,{children:"Propagate Authorization Header"})," v\xe6re huket av. Tilgangs-tokenet blir da sendt til backend-API-et, og samme eller en mer grundig sjekk av tokenet foretas der. Det vil og forhindre urettmessig tilgang til API-et dersom man sp\xf8r backend-API-et direkte uten \xe5 g\xe5 via gatewayen."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"User claim"})," fungerer ikke p.t. med maskinporten."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Additional selection rules."})," Her kan det bli litt komplisert. Her kan man legge inn flere regler for \xe5 v\xe6re sikker p\xe5 at riktig plan blir valgt. Om API-et kun skal brukes av et scope kan du legge inn en sjekk av scope her. Er man sikker p\xe5 at tokenet kun vil inneholde dette scopet, bruk f.eks:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Text",children:"#context.attributes['jwt'].claims['scope'] matches '^org:test$'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Vil man tillate at tokenet har andre scope i tilegg til det som gir tilgang til ditt API kan man bruke:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Text",children:"#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Et litt mer avansert eksempel. Har man et API hvor man kan bli tildelt enten lese- og skriverettigheter, eller kun skrive- eller kun leserrettigheter."}),"\n",(0,r.jsx)(n.p,{children:"Da kan man ha en plan for b\xe5de lese og skrivetilgang med denne ekstra regelen:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Text",children:"#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$' && #context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test.write(\\\\s[a-z:\\\\s])?$'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Kun for skirvetilgang:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Text",children:"#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test.write(\\\\s[a-z:\\\\s])?$'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Kun for lesetilgang:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Text",children:"#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Merk at i dette eksempelet betyr rekkef\xf8lgen noe. Planer som krever to scope m\xe5 v\xe6re f\xf8rst i lista over tilgjengelige planer. P\xe5 siden med oversikt over planer kan rekkef\xf8lgen endres."}),"\n",(0,r.jsx)(n.p,{children:"Sjekke for flere grants"}),"\n",(0,r.jsx)(n.p,{children:"Det kan v\xe6re tilfeller hvor man vil ha en plan per organisasjon. Det anbefales ikke om det er mange organisasjoner som skal ha tilgang, men det er mulig, og om det er et endelig lite antall er det overkommelig. For \xe5 legge inn regler som sl\xe5r inn om det er riktig organisasjonsnummer og riktig scope:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Text",children:"#context.attributes['jwt'].claims['consumer']['ID'] == '0192:987654321' && #context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$'\n"})}),"\n",(0,r.jsx)(n.p,{children:'N\xe5r alt er fylt inn, trykk "NEXT".'}),"\n",(0,r.jsxs)(n.p,{children:["For \xe5 legge inn rate-limit, kvoter, svartelisting, hvitelisting eller policy, , se ",(0,r.jsx)(n.a,{href:"/docs/datadeling/veiledere/api-manager/opprette-plan",children:"veiledningen for planer"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Husk at planen m\xe5 publiseres f\xf8r den kan tas i bruk."}),"\n",(0,r.jsx)(n.h3,{id:"registrere-applikasjon",children:"Registrere applikasjon"}),"\n",(0,r.jsxs)(n.p,{children:["For at en applikasjon skal kunne bruke API-et m\xe5 applikasjonen registreres b\xe5de i maskinporten og i Gravitee. F\xf8rst m\xe5 applikasjonen registreres som en integrasjon i maskinporten, og s\xe5 m\xe5 den ",(0,r.jsx)(n.a,{href:"/docs/datadeling/veiledere/api-manager/api-manager-be-om-tilgang",children:"registreres i Gravitee"})," med den client_id som den ble tildelt i maskinporten. Deretter kan applikasjonen s\xf8ke om tilgang til riktig plan og API. N\xe5r tilgang er tildelt kan API-et benyttes. Man bruker ikke API-n\xf8kkel og trenger ikke hente ut denne."]})]})}function p(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}},5592:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/image-20200928124644-1-b1764559e7b57ce2198043795e54e56c.png"},7555:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/image-20201012173900-1-6d0358441eec3fecdf17065005012149.png"},1151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>a});var r=t(7294);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);