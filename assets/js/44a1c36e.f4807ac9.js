"use strict";(self.webpackChunkdocs_sikt_no=self.webpackChunkdocs_sikt_no||[]).push([[4052],{6156:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>g,frontMatter:()=>i,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"datadeling/veiledere/api-manager/backend","title":"Konfigurere backend","description":"For at API gatewayen skal kunne snakke med APIet p\xe5 backend-serveren m\xe5 API-gatewayen som oftest autentisere seg.","source":"@site/docs/datadeling/veiledere/api-manager/backend.md","sourceDirName":"datadeling/veiledere/api-manager","slug":"/datadeling/veiledere/api-manager/backend","permalink":"/docs/datadeling/veiledere/api-manager/backend","draft":false,"unlisted":false,"editUrl":"https://github.com/sikt-no/docs/tree/master/docs/datadeling/veiledere/api-manager/backend.md","tags":[],"version":"current","lastUpdatedAt":1742220772000,"frontMatter":{"description":"For at API gatewayen skal kunne snakke med APIet p\xe5 backend-serveren m\xe5 API-gatewayen som oftest autentisere seg.","title":"Konfigurere backend"},"sidebar":"datadeling","previous":{"title":"Forvaltning av tilganger til API","permalink":"/docs/datadeling/veiledere/api-manager/api-tilganger"},"next":{"title":"Caching i gravitee","permalink":"/docs/datadeling/veiledere/api-manager/caching-gravitee"}}');var s=r(4848),a=r(8453);const i={description:"For at API gatewayen skal kunne snakke med APIet p\xe5 backend-serveren m\xe5 API-gatewayen som oftest autentisere seg.",title:"Konfigurere backend"},d="Konfigurere backend",l={},o=[{value:"Autentisering med API-n\xf8kkel eller brukernavn og passord",id:"autentisering-med-api-n\xf8kkel-eller-brukernavn-og-passord",level:3},{value:"F\xe5 alle requests fra samme IP-adresse",id:"f\xe5-alle-requests-fra-samme-ip-adresse",level:3},{value:"Token-basert",id:"token-basert",level:3},{value:"Sertifikater",id:"sertifikater",level:3},{value:"Timeouts",id:"timeouts",level:3}];function k(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"konfigurere-backend",children:"Konfigurere backend"})}),"\n",(0,s.jsx)(n.p,{children:"For at API gatewayen skal kunne snakke med APIet p\xe5 backend-serveren m\xe5 API gatewayen som oftest autentisere seg."}),"\n",(0,s.jsx)(n.p,{children:"For \xe5 konfigurere hvordan API gatewayen skal koble seg til API-et i bakgrunnen bruker du Gravitee."}),"\n",(0,s.jsx)(n.p,{children:"Naviger til ditt API:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:'Velg "Proxy" i den venstre sidemenyen'}),"\n",(0,s.jsx)(n.li,{children:'Under "BACKEND SERVICES" velger du "Endpoints"'}),"\n",(0,s.jsx)(n.li,{children:'Trykk deretter p\xe5 tannhjulet og menyen for "Endpoint configuration" vil \xe5pnes'}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Konfigurere endpoints",src:r(1293).A+"",width:"1363",height:"580"})}),"\n",(0,s.jsx)(n.p,{children:"Har du flere backend-servere koblet til en gitt API kan du velge \xe5 redigere dem som en gruppe slik at de har like innstillinger som vist i punkt 3. \xd8nsker du heller \xe5 redigere kun \xe9n aktuell backend-server kan du velge tannhjulet direkte bak denne for \xe5 legge inn unike innstillinger."}),"\n",(0,s.jsx)(n.h3,{id:"autentisering-med-api-n\xf8kkel-eller-brukernavn-og-passord",children:"Autentisering med API-n\xf8kkel eller brukernavn og passord"}),"\n",(0,s.jsx)(n.p,{children:"For \xe5 konfigurere autentisering med enten API-n\xf8kkel eller brukernavn og passord m\xe5 dette legges inn som en HTTP-header."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:'Fra "Endpoint configuration" menyen, velg "CONFIGURATION"'}),"\n",(0,s.jsx)(n.li,{children:"Trykk p\xe5 sirkelen med plusstegn ved siden av Headers"}),"\n",(0,s.jsx)(n.li,{children:"Fyll inn navnet til headeren og verdien (n\xf8kkelen) som skal brukes"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Legg til header",src:r(1881).A+"",width:"1070",height:"459"})}),"\n",(0,s.jsx)(n.p,{children:"Er det en annen Gravitee-installasjon i bakgrunnen kan det f.eks. se slik ut:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Eksempel header",src:r(241).A+"",width:"883",height:"407"})}),"\n",(0,s.jsx)(n.p,{children:'Andre systemer bruker ofte andre navn for Headers, f.eks, bare "X-API-Key".'}),"\n",(0,s.jsxs)(n.p,{children:['Ved bruk av "Basic Access Authentication (BA)" autentiserer man med brukernavn og passord. Navnet p\xe5 headeren settes til Authorization og inneholder teksten Basic + mellomrom + brukernavn/passord. Brukernavnet og passordet legges inn som en base64-encodet streng, skilt med : (kolon). F.eks. "brukernavn',":passord",'".']}),"\n",(0,s.jsx)(n.p,{children:"Det finnes mange verkt\xf8y for \xe5 skifte mellom vanlig tekst og base64. I linux kan man f.eks. bruke f\xf8lgende kommando i et terminalvindu for \xe5 enkode:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"echo -n brukernavn:passord | base64\n"})}),"\n",(0,s.jsx)(n.p,{children:"Man kan sjekke at det ble riktig ved \xe5 legge inn den genererte koden etter echo med denne kommandoen:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"echo YnJ1a2VybmF2bjpwYXNzb3JkCg== | base64 -d\n"})}),"\n",(0,s.jsx)(n.p,{children:"For dette eksempelet vil Header se slik ut i Gravitee:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Ferdig header eksempel",src:r(7750).A+"",width:"1007",height:"441"})}),"\n",(0,s.jsx)(n.h3,{id:"f\xe5-alle-requests-fra-samme-ip-adresse",children:"F\xe5 alle requests fra samme IP-adresse"}),"\n",(0,s.jsx)(n.p,{children:"Gravitee er installert p\xe5 en kubernetes-klynge. Den kan derfor kj\xf8re p\xe5 hvilken som helst server i klyngen, og klyngen kan endre seg (utvides/erstattes). I tillegg kj\xf8rer vi alltid med minst to gatewayer \xe5pent for \xe5 unng\xe5 nedetid. API gatewayen vil derfor kunne ha forskjellig ip-adresser. Mange backend-thenester ligger p\xe5 sperrede nett eller \xe5pner kun for enkelt-IP-adresser. For \xe5 unng\xe5 \xe5 eksponere backend-tjenester mer enn n\xf8dvendig kan man konfigurere et API til \xe5 bruke en HTTP-proxy. Foresp\xf8rsler vil da f\xf8rst g\xe5 til proxy-serveren, og deretter omdirigerer proxy-serveren foresp\xf8rselen videre til riktig server. For backend-serveren ser det derfor ut som om foresp\xf8rselen kom fra ip-adressen til proxy-serveren."}),"\n",(0,s.jsx)(n.p,{children:"For \xe5 kunne gj\xf8re dette m\xe5 man ha en proxy-server. Denne b\xf8r v\xe6re sikret slik at ikke alle kan bruke denne. Den kan f.eks. sikres med brukernavn og passord, og kun tillate din bruker \xe5 ta kontakt med den aktuelle backend-serveren."}),"\n",(0,s.jsx)(n.p,{children:'Proxy-konfigurasjon gj\xf8res og\xe5 under HTTP-konfigurasjon. I "CONFIGURATION" menyen, huk av for "HTTP proxy" slik at den markeres i gr\xf8nt som "active", og fyll inn n\xf8dvendig informasjon. Felter som m\xe5 fylles ut er markert med * (stjerne).'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"HTTP proxy oppsett",src:r(9972).A+"",width:"1491",height:"899"})}),"\n",(0,s.jsx)(n.h3,{id:"token-basert",children:"Token-basert"}),"\n",(0,s.jsx)(n.p,{children:"Ved token-basert autentisering menes som oftest autentisering med Java Web Tokens (JWTs). Disse er oftest kortvarige og m\xe5 genereres med jevne mellomrom, f.eks. hver time eller hvert tiende minutt. De kan ogs\xe5 v\xe6re for engangsbruk. Som oftest m\xe5 man lage et en-gangs-token, kontakte en Authorization Server med det genererte en-gangs-tokenet, og f\xe5 tilbake et token som er gyldig i en kort stund."}),"\n",(0,s.jsxs)(n.p,{children:["Token-basert autentisering er sikkert og fleksibelt \xe5 ta i bruk, om enn litt mer komplisert \xe5 konfigurere. Dette gj\xf8res ved hjelp av policies eller et annet API. ",(0,s.jsx)(n.a,{href:"/docs/datadeling/veiledere/api-manager/jwt-mot-backend",children:"Se egen veiledning"})," for detaljert fremgangsm\xe5te."]}),"\n",(0,s.jsx)(n.h3,{id:"sertifikater",children:"Sertifikater"}),"\n",(0,s.jsx)(n.p,{children:"Gatewayen kan autentisere seg med et klient-sertifikat. Dette er, som token-basert autentisering, mye sikrere enn ved bruk av API-n\xf8kkel eller brukernavn og passord. Konfigureres under."}),"\n",(0,s.jsx)(n.p,{children:"SSL - Client Authentication"}),"\n",(0,s.jsx)(n.p,{children:"Fyll inn type sertificat (PKCS#12,PFX, Java key store/PEM-sertifikat/n\xf8kkel-par) samt lim inn sertifikat-fila (eller path til denne om den er gjort tilgjengelig p\xe5 filsystemet til API gateway-en) og evt. passord"}),"\n",(0,s.jsx)(n.h3,{id:"timeouts",children:"Timeouts"}),"\n",(0,s.jsx)(n.p,{children:'Hvis man opplever problemer med at koblingen mellom Gravitee og endepunktet f\xe5r en timeout kan man endre innstillingene til timeout som er satt i Gravitee ved \xe5 endre p\xe5 feltene under "HTTP Configuration". Hvert felt har egen beskrivelse for sin funksjon, og de m\xe5 alle fylles ut.'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Illustrasjon over hvor man setter timeout verdiene i gravitee",src:r(4609).A+"",width:"1152",height:"769"})})]})}function g(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(k,{...e})}):k(e)}},4609:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/2021-11-19-13.33.01-api-qa.intark.uh-it.no-b0f451af01f7-014112fbd79cd132430f9d670a597c8d.jpg"},1293:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20200925142430-1-e390af33c79d4aa15b9a20cbf9f83f7b.png"},1881:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20200925143000-3-ebd909ae9fec8fa0d83deed818a7cd5e.png"},241:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20200925143832-4-13f671bd710e11b21d7a44dfef345f6e.png"},7750:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20200925145447-5-1fc3f9fc0515577f1958b2ccd6167ed0.png"},9972:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20200925151029-6-d5f22fc89bd1165759a3d050342a3f70.png"},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>d});var t=r(6540);const s={},a=t.createContext(s);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);