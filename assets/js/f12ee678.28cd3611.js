"use strict";(self.webpackChunkdocs_sikt_no=self.webpackChunkdocs_sikt_no||[]).push([[7995],{7127:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"kudaf/data-protect","title":"Protect data endpoint","description":"When receiving a request for data. You should perform the proper token","source":"@site/docs/kudaf/data-protect.md","sourceDirName":"kudaf","slug":"/kudaf/data-protect","permalink":"/docs/kudaf/data-protect","draft":false,"unlisted":false,"editUrl":"https://github.com/sikt-no/docs/tree/master/docs/kudaf/data-protect.md","tags":[],"version":"current","lastUpdatedAt":1738140190000,"frontMatter":{},"sidebar":"kudaf","previous":{"title":"Describe data as metadata","permalink":"/docs/kudaf/data-describe"}}');var r=n(4848),o=n(8453);const a={},s="Protect data endpoint",d={},c=[{value:"Validate Feide token",id:"validate-feide-token",level:2},{value:"Data authorization",id:"data-authorization",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"protect-data-endpoint",children:"Protect data endpoint"})}),"\n",(0,r.jsx)(t.p,{children:"When receiving a request for data. You should perform the proper token\nvalidation and variable authorization to identify if the requester rightfully\nhas access to claimed resource."}),"\n",(0,r.jsx)(t.h2,{id:"validate-feide-token",children:"Validate Feide token"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Extract JSON Web Token (JWT) from the HTTP request's Authorization header\nusing Bearer schema."}),"\n",(0,r.jsxs)(t.li,{children:["Locate the public key needed for decoding the token by visiting\n",(0,r.jsx)(t.a,{href:"https://auth.dataporten.no/.well-known/openid-configuration",children:"https://auth.dataporten.no/.well-known/openid-configuration"})," and look for\nproperty ",(0,r.jsx)(t.code,{children:"jwks_uri"}),"."]}),"\n",(0,r.jsx)(t.li,{children:"Extract the public key found in the JSON Web Key Set (JWKS) URL from the\nprevious step."}),"\n",(0,r.jsx)(t.li,{children:"Verify that the JWK's key identifier (kid) is the same as the received\ntoken's kid."}),"\n",(0,r.jsx)(t.li,{children:"Decode the received token using public key, expected audience (being your\ndatasource's identifier) and RS256 algorithm."}),"\n",(0,r.jsxs)(t.li,{children:["Validate token. See the\n",(0,r.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc9068.html#section-4",children:"JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens"}),"\nfor full details about JWT access token validation.","\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Ensure ",(0,r.jsx)(t.code,{children:"iss"})," has to be ",(0,r.jsx)(t.code,{children:"https://auth.dataporten.no"})]}),"\n",(0,r.jsxs)(t.li,{children:["Ensure ",(0,r.jsx)(t.code,{children:"aud"})," contains your datasource's identifier."]}),"\n",(0,r.jsxs)(t.li,{children:["Ensure current time is in the interval between the ",(0,r.jsx)(t.code,{children:"iat"})," and ",(0,r.jsx)(t.code,{children:"exp"})," timestamps."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"data-authorization",children:"Data authorization"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Having validated the Feide token you should extract subject identifier ",(0,r.jsx)(t.code,{children:"sub"}),"\nin the token."]}),"\n",(0,r.jsxs)(t.li,{children:["Make a GET request to\n",(0,r.jsx)(t.a,{href:"https://kudaf-core.paas2.uninett.no/api/v1/permissions/%7BSUBJECT_ID%7D/%7BDATASOURCE_ID%7D",children:"https://kudaf-core.paas2.uninett.no/api/v1/permissions/{SUBJECT_ID}/{DATASOURCE_ID}"}),"\nwith parameters ",(0,r.jsx)(t.code,{children:"SUBJECT_ID"})," from previous step and ",(0,r.jsx)(t.code,{children:"DATASOURCE_ID"})," being\nyour known datasource identifier from Kundeportalen."]}),"\n",(0,r.jsxs)(t.li,{children:["In the response, extract the token from the property ",(0,r.jsx)(t.code,{children:"authroizations"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Validate KUDAF token","\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Extract JSON Web Token (JWT) from the HTTP request's Authorization header\nusing Bearer schema."}),"\n",(0,r.jsxs)(t.li,{children:["Locate the public key needed for decoding the token by visiting\n",(0,r.jsx)(t.a,{href:"https://kudaf-core.paas2.uninett.no/api/v1/auth/.well-known/openid-configuration",children:"https://kudaf-core.paas2.uninett.no/api/v1/auth/.well-known/openid-configuration"}),"\nand look for property ",(0,r.jsx)(t.code,{children:"jwks_uri"}),"."]}),"\n",(0,r.jsx)(t.li,{children:"Extract the public key found in the JSON Web Key Set (JWKS) URL from the\nprevious step."}),"\n",(0,r.jsx)(t.li,{children:"Verify that the JWK's key identifier (kid) is the same as the received\ntoken's kid."}),"\n",(0,r.jsx)(t.li,{children:"Decode the received token using public key, expected audience\n(being your datasource's identifier) and RS256 algorithm."}),"\n",(0,r.jsxs)(t.li,{children:["Validate token. See the\n",(0,r.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc9068.html#section-4",children:"JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens"}),"\nfor full details about JWT access token validation.","\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Ensure ",(0,r.jsx)(t.code,{children:"iss"})," has to be ",(0,r.jsx)(t.code,{children:"kudaf-core.paas2.uninett.no/api/v1/auth"})]}),"\n",(0,r.jsxs)(t.li,{children:["Ensure ",(0,r.jsx)(t.code,{children:"aud"})," contains your datasource's identifier."]}),"\n",(0,r.jsxs)(t.li,{children:["Ensure current time is in the interval between the ",(0,r.jsx)(t.code,{children:"iat"})," and ",(0,r.jsx)(t.code,{children:"exp"})," timestamps."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.li,{children:"Decode the token and map out the array of variables inside the datasource property."}),"\n",(0,r.jsx)(t.li,{children:"Authorize access to data based on permitted variables from previous step."}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>s});var i=n(6540);const r={},o=i.createContext(r);function a(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);