"use strict";(self.webpackChunkdocs_sikt_no=self.webpackChunkdocs_sikt_no||[]).push([[5811],{2068:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var i=t(4848),r=t(8453);const s={description:"Hjelp til oppsett av DF\xd8 SAP sine REST API.",title:"DF\xd8 SAP"},l="DF\xd8 SAP",a={id:"datadeling/teknisk-plattform/api/dfo-sap",title:"DF\xd8 SAP",description:"Hjelp til oppsett av DF\xd8 SAP sine REST API.",source:"@site/docs/datadeling/teknisk-plattform/api/dfo-sap.md",sourceDirName:"datadeling/teknisk-plattform/api",slug:"/datadeling/teknisk-plattform/api/dfo-sap",permalink:"/docs/datadeling/teknisk-plattform/api/dfo-sap",draft:!1,unlisted:!1,editUrl:"https://github.com/sikt-no/docs/tree/master/docs/datadeling/teknisk-plattform/api/dfo-sap.md",tags:[],version:"current",lastUpdatedAt:1729688885e3,frontMatter:{description:"Hjelp til oppsett av DF\xd8 SAP sine REST API.",title:"DF\xd8 SAP"},sidebar:"datadeling",previous:{title:"Oversikt over den tekniske plattformen",permalink:"/docs/datadeling/teknisk-plattform/oversikt"},next:{title:"Digdir Folkeregisteret og KRR",permalink:"/docs/datadeling/teknisk-plattform/api/digdir"}},o={},d=[{value:"Om API-ene",id:"om-api-ene",level:2},{value:"Standardoppsett",id:"standardoppsett",level:2},{value:"Hvordan sette opp API-ene",id:"hvordan-sette-opp-api-ene",level:2},{value:"Hvordan verifisere at API-et fungerer:",id:"hvordan-verifisere-at-api-et-fungerer",level:3}];function p(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"df\xf8-sap",children:"DF\xd8 SAP"})}),"\n",(0,i.jsx)(n.p,{children:"Hjelp til oppsett av DF\xd8 SAP sine REST API."}),"\n",(0,i.jsx)(n.h2,{id:"om-api-ene",children:"Om API-ene"}),"\n",(0,i.jsx)(n.p,{children:"DF\xd8s l\xf8sninger for \xf8konomi og l\xf8nn brukes av mange i sektoren. DF\xd8 tilbyr API som er felles for sektoren, men der hver institusjon f\xe5r ut sine data."}),"\n",(0,i.jsxs)(n.p,{children:["DF\xd8 tilbyr flere ulike API-er for ulike data, som ansattinformasjon, stillingsdata og organisasjonsdata. Se ",(0,i.jsx)(n.a,{href:"https://api-portal.dfo.no/",children:"DF\xd8s API-portal"})," for mer informasjon."]}),"\n",(0,i.jsx)(n.p,{children:'For \xe5 kunne bruke DF\xd8s API m\xe5 din institusjon bli "oppgradert" hos DF\xd8. Mange institusjoner m\xe5 i dag forholde seg til CSV-filer fra DF\xd8. Dette m\xe5 gj\xf8res i dialog med DF\xd8, og dette vil kunne ta tid.'}),"\n",(0,i.jsxs)(n.p,{children:["DF\xd8 krever autentisering via\n",(0,i.jsx)(n.a,{href:"https://samarbeid.digdir.no/maskinporten/maskinporten/25",children:"Maskinporten"})," i sin\nkommunikasjon, s\xe5 institusjonen m\xe5 registrere seg der f\xf8r integrasjonen kan\np\xe5begynnes. Maskinporten benytter ",(0,i.jsx)(n.a,{href:"https://www.ssh.com/academy/ssh/public-key-authentication",children:"Public Key Authentication"})," for autentisering. Oppsettet inneb\xe6rer at institusjonen genererer en hemmelig privat n\xf8kkel til seg selv og en korresponderende offentlig n\xf8kkel til Maskinporten. Den private n\xf8kkelen brukes for \xe5 bekrefte identiteten til innehaveren, i dette tilfellet institusjonen. Den offentlige n\xf8kkelen brukes av Maskinporten for \xe5 autentisere institusjonen og til \xe5 autorisere tilgang."]}),"\n",(0,i.jsxs)(n.p,{children:["Som de fleste andre APIene settes APIet opp med autentisering mot v\xe5r API gateway, og deretter sendes requesten videre til backend-APIet. I API gatewayen legger vi p\xe5 token og evt. API-n\xf8kkel som brukes mot DF\xd8s APIer. Tjenesten som utsteder token kan enten settes opp i Gravitee (",(0,i.jsx)(n.a,{href:"/docs/datadeling/teknisk-plattform/api/maskinporten",children:"se bruksanvisning her"}),") eller hos den enkelte institusjon"]}),"\n",(0,i.jsx)(n.h2,{id:"standardoppsett",children:"Standardoppsett"}),"\n",(0,i.jsx)(n.p,{children:"DF\xd8 er en fellestjeneste, og m\xe5/b\xf8r derfor settes opp likt hos alle institusjoner. Du kan sette dette opp ved \xe5 laste inn fil med standardoppsett:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(5421).A+"",children:"Lonnssystem-api-template.json"})}),"\n",(0,i.jsx)(n.h2,{id:"hvordan-sette-opp-api-ene",children:"Hvordan sette opp API-ene"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Registrer din institusjon hos Maskinporten, ",(0,i.jsx)(n.a,{href:"https://samarbeid.digdir.no/maskinporten/konsument/119",children:"se planleggingsaktiviteten her"}),". Registrer deretter en integrasjon i maskinporten, se veiledning her(",(0,i.jsx)(n.a,{href:"https://docs.digdir.no/docs/Maskinporten/maskinporten_sjolvbetjening_web.html",children:"https://docs.digdir.no/docs/Maskinporten/maskinporten_sjolvbetjening_web.html"}),") Sluttresultatet er at du har en integrasjon hvor du kan autentisere vha. virksomhetssertifikat eller et sertifikat du har laget selv (og som bare brukes mot denne integrasjonen) Integrasjonen m\xe5 ha blitt tildelt de n\xf8dvendige scopes og du m\xe5 ha issuer-ID tilgjengelig"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Opprett tokentjeneste om du ikke har gjort det tidligere og gi APIet tilgang."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Om du vil lage en i gravitee ",(0,i.jsx)(n.a,{href:"/docs/datadeling/teknisk-plattform/api/maskinporten",children:"se veiledning her"})," Gi deretter SAP-APIet tilgang ved \xe5 opprette en applikasjon for dette og s\xf8k om tilgang til maskinporten-APIet. N\xe5r tilgangen er gitt f\xe5r du en API-n\xf8kkel som vi bruker i neste steg"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Last ned standardoppsettet over, og opprett tjenesten i API manager. Se ",(0,i.jsx)(n.a,{href:"/docs/datadeling/veiledere/api-manager/importer-api",children:"veileder for \xe5 registrere en tjeneste i API manager via fil"}),"."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"G\xe5 inn i APIet og endre p\xe5 Navn og beskrivelse"}),"\n",(0,i.jsx)(n.li,{children:"G\xe5 til proxy -> Entrypoint og evt. endre dette"}),"\n",(0,i.jsxs)(n.li,{children:['Hvis prod: g\xe5 inn p\xe5 proxy -> backend services. Fjern "-test" fra URLen slik at det st\xe5r ',(0,i.jsx)(n.a,{href:"https://api.dfo.no",children:"https://api.dfo.no"})]}),"\n",(0,i.jsx)(n.li,{children:"Klikk p\xe5 Design og policy-en HTTP Callout. Endre URL til den til tokentjenesten. Endre headeren X-Gravitee-Api-Key til n\xf8kkelen fra punkt 2 om du har satt opp maskinporten-API i API Manager. Under headeren iss legger du inn ISSUER-ID for maskinporten-integrasjonen. Om du kj\xf8rer token-tjenesten selv, konfigurer sikker autentisering og evt. headere/parametre etter behov."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Registrer DF\xd8 SAP som tjeneste i ",(0,i.jsx)(n.em,{children:"Selvbetjeningsportalen for RabbitMQ"})," (se ",(0,i.jsx)(n.a,{href:"/docs/datadeling/veiledere/meldingsk%C3%B8/opprett-tjeneste",children:"veileder for \xe5 registrere tjenesten"}),"). Hent ut tilkoblingsdetaljene som det blir opplyst om."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Om DF\xd8 skal publisere meldinger direkte til deres RabbitMQ, send en foresp\xf8rsel om etablering av notifikasjonsoverf\xf8ring til ",(0,i.jsx)(n.a,{href:"mailto:it-support@dfo.no",children:"it-support@dfo.no"}),". Legg ved tilkoblingsdetaljene som du finner i selvbetjeningsportalen. Passordet b\xf8r sendes via en sikker tredje kanal (",(0,i.jsx)(n.em,{children:"ikke"})," via e-post)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Om dere heller vil hente meldinger fra rabbitmq hos DF\xd8 (eller en annen rabbitmq-installasjon) gj\xf8res det vel \xe5 sette opp en shovel i rabbitMQ. Det finnes flere oppskrifter p\xe5 hvordan man setter opp shovel. Her er oppskrift p\xe5 en m\xe5te man kan sette det opp i rabbitMQ, mens man fremdeles gj\xf8r tilgangsstyring i BROM. Dette krever ekstra tilganger i rabbitMQ for \xe5 gj\xf8re n\xf8dvendig oppsett."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Registrer applikasjon i BROM. Velg at den skal publisere meldinger. Velg et godt navn og beskrivelse, dette er applikasjonen som utviklere abonnerer p\xe5 om de vil ha meldinger fra deres SAP-installasjon"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"(Valgfritt) For \xe5 lett kunne se om shovel-en fungerer kan du opprette en applikasjon som abonnerer p\xe5 meldinger fra applikasjonen du opprettet i forrige punkt. Godkjenn denne. N\xe5r shovelen fungerer vil det komme meldinger inn i meldingsk\xf8en for denne applikasjonen. Merk: denne b\xf8r slettes i ettertid."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Om IntArk-koordinator ikke har n\xf8dvendige rettigheter i rabbitMQ fra f\xf8r,\xa0 kontakt support som oppretter bruker med n\xf8dvendinge rettigheter."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"S\xf8rg for \xe5 ha tilkoblingsinformasjon (brukernavn, passord, vhost, k\xf8-navn, hostnavn) tilgjengelig"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Logg inn i rabbitMQ med bruker som har rettigheter til \xe5 opprette shovel. I BROM er det link til innloggingsiden her: ",(0,i.jsx)(n.img,{alt:"applikasjonsinfo i BROM",src:t(8194).A+"",width:"1143",height:"671"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:['Naviger til siden "Admin" og undemenyen "Shovel Management" ',(0,i.jsx)(n.img,{alt:"webside for Shovel management i rabbitmq",src:t(4661).A+"",width:"1247",height:"809"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Under Add shovel, fyll ut:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Velg vhost med samme navn som applikasjonen i punkt 1 (ikke n\xf8dvendig, men gj\xf8r det lettere \xe5 holde oversikt senere)"}),"\n",(0,i.jsx)(n.li,{children:"Gi et godt navn"}),"\n",(0,i.jsx)(n.li,{children:"Under source s\xe5 er protocol nesten alltid AMQP 0.9.1, s\xe5 det kan st\xe5"}),"\n",(0,i.jsxs)(n.li,{children:["source URI: adresse for \xe5 koble seg p\xe5 DF\xd8s rabbitmq riktig. Denne er litt komplisert. Den skal v\xe6re amqps://BRUKERNAVN",":PASSORD","@mq.dfo.no/VHOST"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"TIPS: lag denne i notepad eller annen tekstbehandler og bruk klipp og lim for \xe5 fylle inn i rabbitMQ. Feltet for dette i RabbitMQ er for kort til \xe5 se evt. feil"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"source queue: navn p\xe5 k\xf8"}),"\n",(0,i.jsxs)(n.li,{children:["destination URI: her er det samme rabbimtmq som vi er logget inn p\xe5, s\xe5 denne er lettere Fyll inn amqp:///VHOST (hvor vhost er navnet p\xe5 applikasjonen fra punkt 1) ",(0,i.jsx)(n.em,{children:"OBS: merk at det er 3 skr\xe5streker!"})]}),"\n",(0,i.jsx)(n.li,{children:"Endre fra queue til exchange"}),"\n",(0,i.jsx)(n.li,{children:"fyll inn navn p\xe5 exchange. Det er outgoing_APPLIKASJONSNAVN (alts\xe5 outgoing + underscore + navn p\xe5 appliasjon. Du kan og se det under tilkoblingsdetaljer p\xe5 publiseringsiden i brom)"}),"\n",(0,i.jsx)(n.li,{children:"routing key: La denne v\xe6re blank. (Da vil meldingene beholde routing key som de har i kilden. Om du setter en verdi her til denne verdien overskrive eksisterende routing key)"}),"\n",(0,i.jsx)(n.li,{children:'Til sist trykk p\xe5 "add shovel" G\xe5 til siden "Shovel status" og se at shovlen du har laget endrer status til Started. Om den ikke endrer seg fra Starting til Started ila. et par minutter: sjekk tilkoblingsdetaljene, slett shovelen og opprett p\xe5 nytt'}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"API-et og meldingsh\xe5ndtering er n\xe5 satt opp."}),"\n",(0,i.jsx)(n.h3,{id:"hvordan-verifisere-at-api-et-fungerer",children:"Hvordan verifisere at API-et fungerer:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Opprett din egen klient (applikasjon) i API manager, om du ikke har dette allerede."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Be om tilgang til API-et."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Godkjenn tilgangen til API-et. Du har n\xe5 f\xe5tt en egen API-n\xf8kkel for din klient."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Bruk klientens API-n\xf8kkel, og sjekk at du f\xe5r hentet ut data:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Med curl (husk \xe5 endre det som st\xe5r i uthevet tekst):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\ncurl --include -H "X-Gravitee-Api-Key: **API-n\xf8kkel**" https://gw-**INSTANS**.intark.uh-it.no/**lonn**/v1/organisasjoner/v1/\n\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Med Powershell (husk \xe5 endre det som st\xe5r i uthevet tekst):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n$headers = @{\n  'Accept' = 'application/json'\n  'X-Gravitee-Api-Key' = **API-n\xf8kkel**\n}\nInvoke-WebRequest -Headers $headers -Uri \"https://gw-**INSTANS**.intark.uh-it.no/**lonn**/v1/organisasjoner/v1\"\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'Hvis alt er ok kan du forvente \xe5 f\xe5 tilbake noe som starter med "HTTP 200" og JSON-data.'}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},5421:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/files/Lonnssystem-api-template-c2bb7618a89eb9664e1329b1d0449852.json"},8194:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/image-20211006190506-1-76008a2e1ddd40fbd524c65ba3682e6c.png"},4661:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/rabbitmq-shovel-1-a1ca366ec6382f9218019e3e4f4b160a.png"},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var i=t(6540);const r={},s=i.createContext(r);function l(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);